<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>CONSOLE v3.0 - ×§×•× ×¡×•×œ ××ª×•×§×Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background-color: #d4e6d1;
            color: #333;
            padding: 20px;
            overflow-x: auto;
        }
        
        /* × ×™×¡×™×•×Ÿ ×œ× ×˜×¨×œ ×”×•×“×¢×•×ª ×©×’×™××” */
        * {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        .header {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #00ff00;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .header-center {
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
            flex: 2;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-right: 20px;
            flex: 1;
            justify-content: flex-end;
        }

        .reset-console-btn {
            background: linear-gradient(45deg, #4a90e2, #357abd);
            color: #ffffff;
            border: 2px solid #4a90e2;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(74, 144, 226, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .reset-console-btn:hover {
            background: linear-gradient(45deg, #357abd, #4a90e2);
            border-color: #357abd;
            transform: scale(1.05);
            box-shadow: 0 3px 6px rgba(74, 144, 226, 0.4);
        }

        .reset-console-btn:active {
            transform: scale(0.95);
            box-shadow: 0 1px 2px rgba(74, 144, 226, 0.3);
        }

        .auto-scroll-btn {
            background: linear-gradient(45deg, #ff6b35, #f7931e);
            color: #ffffff;
            border: 2px solid #ff6b35;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(255, 107, 53, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .auto-scroll-btn:hover {
            background: linear-gradient(45deg, #f7931e, #ff6b35);
            border-color: #f7931e;
            transform: scale(1.05);
            box-shadow: 0 3px 6px rgba(255, 107, 53, 0.4);
        }

        .auto-scroll-btn.active {
            background: linear-gradient(45deg, #28a745, #20c997);
            border-color: #28a745;
        }

        .auto-scroll-btn.active:hover {
            background: linear-gradient(45deg, #20c997, #28a745);
            border-color: #20c997;
        }

        .status-led {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #00ff00;
            border: 2px solid #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            animation: gentlePulse 2s infinite;
        }

        .status-led.connected {
            background-color: #00ff00;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
            animation: gentlePulse 2s infinite;
        }

        .status-led.disconnected {
            background-color: #ff0000;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
            animation: pulse 1s infinite;
        }

        .status-led.loading {
            background-color: #ffff00;
            box-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
            animation: pulse 1s infinite;
        }

        @keyframes gentlePulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .header h1 {
            color: #00ff00;
            font-size: 2em;
            margin: 0;
        }

        .header p {
            color: #888;
            text-align: center;
            font-size: 1.1em;
        }

        .controls {
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #444;
        }

        .controls button {
            background-color: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .controls button:hover {
            background-color: #00cc00;
        }

        .controls button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }

        .console-output {
            background-color: #000;
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 20px;
            height: 70vh;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.4;
            user-select: text; /* ×××¤×©×¨ ×‘×—×™×¨×ª ×˜×§×¡×˜ */
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }

        .log-entry {
            margin-bottom: 1px;
            padding: 1px 0;
            line-height: 1.1;
        }

        .log-entry.INFO {
            color: #00ff00;
        }

        .log-entry.SUCCESS {
            color: #00ff00;
            font-weight: bold;
        }

        .log-entry.ERROR {
            color: #ff0000;
            font-weight: bold;
        }

        .log-entry.WARNING {
            color: #ffff00;
            font-weight: bold;
        }

        .timestamp {
            color: #888;
            margin-left: 10px;
        }

        .status {
            background-color: #2a2a2a;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            border-left: 4px solid #00ff00;
        }

        .status.info {
            border-left-color: #00ff00;
        }

        .status.success {
            border-left-color: #00ff00;
            background-color: #002200;
        }

        .status.error {
            border-left-color: #ff0000;
            background-color: #220000;
        }

        .auto-scroll {
            background-color: #333;
            color: #fff;
            border: 1px solid #666;
            padding: 5px 10px;
            border-radius: 4px;
            margin-left: 10px;
        }

        .auto-scroll.active {
            background-color: #00ff00;
            color: #000;
        }

        .clear-btn {
            background-color: #ff0000;
            color: #fff;
        }

        .clear-btn:hover {
            background-color: #cc0000;
        }

        .reset-btn {
            background-color: #ff3300;
            color: #fff;
        }

        .reset-btn:hover {
            background-color: #cc2600;
        }


        .restart-btn {
            background: linear-gradient(45deg, #ff0000, #ff6600);
            color: #ffffff;
            border: 2px solid #ff0000;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(255, 0, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .restart-btn:hover {
            background: linear-gradient(45deg, #ff3300, #ff9900);
            border-color: #ff3300;
            transform: scale(1.02);
            box-shadow: 0 3px 6px rgba(255, 0, 0, 0.4);
        }

        .restart-btn:active {
            transform: scale(0.98);
            box-shadow: 0 1px 2px rgba(255, 0, 0, 0.3);
        }

        .refresh-btn {
            background-color: #0066ff;
            color: #fff;
        }

        .refresh-btn:hover {
            background-color: #0052cc;
        }

        .back-btn {
            background-color: #666;
            color: #fff;
        }

        .back-btn:hover {
            background-color: #888;
        }

        .backup-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: #ffffff;
            border: 2px solid #4CAF50;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .backup-btn:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
            border-color: #45a049;
            transform: scale(1.02);
            box-shadow: 0 3px 6px rgba(76, 175, 80, 0.4);
        }

        .backup-btn:active {
            transform: scale(0.98);
            box-shadow: 0 1px 2px rgba(76, 175, 80, 0.3);
        }

        .cursor-prompts-btn {
            background: linear-gradient(45deg, #9C27B0, #673AB7);
            color: #ffffff;
            border: 2px solid #9C27B0;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(156, 39, 176, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .cursor-prompts-btn:hover {
            background: linear-gradient(45deg, #8E24AA, #5E35B1);
            border-color: #8E24AA;
            transform: scale(1.02);
            box-shadow: 0 3px 6px rgba(156, 39, 176, 0.4);
        }

        .cursor-prompts-btn:active {
            transform: scale(0.98);
            box-shadow: 0 1px 2px rgba(156, 39, 176, 0.3);
        }

        .docs-btn {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            color: #ffffff;
            border: 2px solid #FF9800;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(255, 152, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .docs-btn:hover {
            background: linear-gradient(45deg, #F57C00, #FF9800);
            border-color: #F57C00;
            transform: scale(1.02);
            box-shadow: 0 3px 6px rgba(255, 152, 0, 0.4);
        }

        .docs-btn:active {
            transform: scale(0.98);
            box-shadow: 0 1px 2px rgba(255, 152, 0, 0.3);
        }

        .outlook-addin-btn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: #ffffff;
            border: 2px solid #2196F3;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(33, 150, 243, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .outlook-addin-btn:hover {
            background: linear-gradient(45deg, #1976D2, #2196F3);
            border-color: #1976D2;
            transform: scale(1.02);
            box-shadow: 0 3px 6px rgba(33, 150, 243, 0.4);
        }

        .outlook-addin-btn:active {
            transform: scale(0.98);
            box-shadow: 0 1px 2px rgba(33, 150, 243, 0.3);
        }

        .transfer-scores-btn {
            background: linear-gradient(45deg, #4CAF50, #388E3C);
            color: #ffffff;
            border: 2px solid #4CAF50;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .transfer-scores-btn:hover {
            background: linear-gradient(45deg, #388E3C, #4CAF50);
            border-color: #388E3C;
            transform: scale(1.02);
            box-shadow: 0 3px 6px rgba(76, 175, 80, 0.4);
        }

        .transfer-scores-btn:active {
            transform: scale(0.98);
            box-shadow: 0 1px 2px rgba(76, 175, 80, 0.3);
        }

        .copy-console-btn {
            background: linear-gradient(45deg, #9C27B0, #7B1FA2);
            color: #ffffff;
            border: 2px solid #9C27B0;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(156, 39, 176, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .copy-console-btn:hover {
            background: linear-gradient(45deg, #7B1FA2, #9C27B0);
            border-color: #7B1FA2;
            transform: scale(1.02);
            box-shadow: 0 3px 6px rgba(156, 39, 176, 0.4);
        }

        .copy-console-btn:active {
            transform: scale(0.98);
            box-shadow: 0 1px 2px rgba(156, 39, 176, 0.3);
        }

        .special-buttons-row {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
        }

        .backup-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
            margin-top: 15px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #4CAF50;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .version-input {
            width: 100%;
            max-width: 400px;
            padding: 10px 15px;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            color: #333;
            transition: all 0.3s ease;
        }

        .version-input:focus {
            outline: none;
            border-color: #45a049;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.3);
        }

        .version-input::placeholder {
            color: #666;
            font-style: italic;
        }

        .backup-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .confirm-backup-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: #ffffff;
            border: 2px solid #4CAF50;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .confirm-backup-btn:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
            transform: scale(1.05);
        }

        .cancel-backup-btn {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: #ffffff;
            border: 2px solid #f44336;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .cancel-backup-btn:hover {
            background: linear-gradient(45deg, #d32f2f, #f44336);
            transform: scale(1.05);
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
        }

        body.dark-mode .header {
            background-color: #2a2a2a;
            color: #ffffff;
        }

        body.dark-mode .controls {
            background: #2d2d2d;
            border-color: #555;
        }

        body.dark-mode .console-output {
            background: #2d2d2d;
            color: #e0e0e0;
            border-color: #555;
        }

        body.dark-mode .log-entry {
            background: #3d3d3d;
            border-color: #555;
        }

        body.dark-mode .log-entry.info {
            background: #2a3a4a;
            border-right-color: #17a2b8;
        }

        body.dark-mode .log-entry.success {
            background: #2a4a2a;
            border-right-color: #28a745;
        }

        body.dark-mode .log-entry.warning {
            background: #4a3a2a;
            border-right-color: #ffc107;
        }

        body.dark-mode .log-entry.error {
            background: #4a2a2a;
            border-right-color: #dc3545;
        }

        body.dark-mode .status {
            background: #3d3d3d;
            color: #e0e0e0;
        }

        body.dark-mode .status.success {
            background: #2a4a2a;
            color: #90ee90;
        }

        body.dark-mode .status.error {
            background: #4a2a2a;
            color: #ff6b6b;
        }

        body.dark-mode .status.info {
            background: #2a3a4a;
            color: #87ceeb;
        }

        body.dark-mode .backup-section {
            background: #404040;
            border-color: #4CAF50;
        }

        body.dark-mode .version-input {
            background: #3d3d3d;
            color: #e0e0e0;
            border-color: #4CAF50;
        }

        /* Light Mode Styles */
        body:not(.dark-mode) .console-output {
            background-color: #ffffff;
            border-color: #4CAF50;
        }

        body:not(.dark-mode) .log-entry {
            background-color: #f8f9fa;
            padding: 1px 12px;
            margin-bottom: 1px;
            border-radius: 4px;
            border-right: 3px solid #4CAF50;
            line-height: 1.1;
        }

        body:not(.dark-mode) .log-entry.INFO {
            color: #0066cc;
            border-right-color: #17a2b8;
        }

        body:not(.dark-mode) .log-entry.SUCCESS {
            color: #28a745;
            border-right-color: #28a745;
            background-color: #f8fff8;
        }

        body:not(.dark-mode) .log-entry.ERROR {
            color: #dc3545;
            border-right-color: #dc3545;
            background-color: #fff8f8;
        }

        body:not(.dark-mode) .log-entry.WARNING {
            color: #ffc107;
            border-right-color: #ffc107;
            background-color: #fffef8;
        }

        body:not(.dark-mode) {
            background-color: #d4e6d1;
            color: #333;
        }

        body:not(.dark-mode) .header h1 {
            color: #00ff00;
        }

        body:not(.dark-mode) .header p {
            color: #666;
        }

        body:not(.dark-mode) .dark-mode-toggle {
            background: linear-gradient(45deg, #e0e0e0, #f0f0f0);
            color: #333;
            border-color: #ccc;
        }

        body:not(.dark-mode) .dark-mode-toggle:hover {
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
        }

        body:not(.dark-mode) .status {
            background-color: #f8f9fa;
            border-left-color: #4CAF50;
        }

        body:not(.dark-mode) .status.info {
            border-left-color: #17a2b8;
            background-color: #f0f8ff;
        }

        body:not(.dark-mode) .status.success {
            border-left-color: #28a745;
            background-color: #f8fff8;
        }

        body:not(.dark-mode) .status.error {
            border-left-color: #dc3545;
            background-color: #fff8f8;
        }

        body:not(.dark-mode) .controls {
            background-color: #f8f9fa;
            border-color: #dee2e6;
        }

        body:not(.dark-mode) .controls button {
            background-color: #4CAF50;
            color: #ffffff;
        }

        body:not(.dark-mode) .controls button:hover {
            background-color: #45a049;
        }

        body:not(.dark-mode) .controls button:disabled {
            background-color: #6c757d;
            color: #ffffff;
        }

        body:not(.dark-mode) .backup-section {
            background: #f8f9fa;
            border-color: #4CAF50;
        }

        body:not(.dark-mode) .version-input {
            background: #ffffff;
            color: #333;
            border-color: #4CAF50;
        }

        body:not(.dark-mode) .version-input:focus {
            border-color: #45a049;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.3);
        }

        body.dark-mode .cursor-prompts-btn {
            background: linear-gradient(45deg, #7B1FA2, #512DA8);
            border-color: #7B1FA2;
        }

        body.dark-mode .cursor-prompts-btn:hover {
            background: linear-gradient(45deg, #6A1B9A, #4527A0);
            border-color: #6A1B9A;
        }

        body.dark-mode .docs-btn {
            background: linear-gradient(45deg, #E65100, #D84315);
            border-color: #E65100;
        }

        body.dark-mode .docs-btn:hover {
            background: linear-gradient(45deg, #D84315, #E65100);
            border-color: #D84315;
        }

        body.dark-mode .outlook-addin-btn {
            background: linear-gradient(45deg, #1565C0, #0D47A1);
            border-color: #1565C0;
        }

        body.dark-mode .outlook-addin-btn:hover {
            background: linear-gradient(45deg, #0D47A1, #1565C0);
            border-color: #0D47A1;
        }

        body.dark-mode .transfer-scores-btn {
            background: linear-gradient(45deg, #2E7D32, #1B5E20);
            border-color: #2E7D32;
        }

        body.dark-mode .transfer-scores-btn:hover {
            background: linear-gradient(45deg, #1B5E20, #2E7D32);
            border-color: #1B5E20;
        }

        body.dark-mode .copy-console-btn {
            background: linear-gradient(45deg, #6A1B9A, #4A148C);
            border-color: #6A1B9A;
        }

        body.dark-mode .copy-console-btn:hover {
            background: linear-gradient(45deg, #4A148C, #6A1B9A);
            border-color: #4A148C;
        }

        body.dark-mode .reset-console-btn {
            background: linear-gradient(45deg, #5a9fd4, #4a8bc2);
            border-color: #5a9fd4;
        }

        body.dark-mode .reset-console-btn:hover {
            background: linear-gradient(45deg, #4a8bc2, #5a9fd4);
            border-color: #4a8bc2;
        }

        body.dark-mode .auto-scroll-btn {
            background: linear-gradient(45deg, #ff7a4a, #ffa726);
            border-color: #ff7a4a;
        }

        body.dark-mode .auto-scroll-btn:hover {
            background: linear-gradient(45deg, #ffa726, #ff7a4a);
            border-color: #ffa726;
        }

        /* Collapsible blocks styling */
        .collapsible-block {
            margin: 5px 0;
            border: 1px solid #4CAF50;
            border-radius: 5px;
            background-color: rgba(76, 175, 80, 0.1);
        }
        
        .collapsible-header {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 8px 12px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px 4px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .collapsible-header:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
        }
        
        .collapsible-content {
            max-height: 200px;
            overflow-y: auto;
            background-color: rgba(76, 175, 80, 0.05);
            border-radius: 0 0 4px 4px;
            transition: max-height 0.3s ease;
        }
        
        .collapsible-content.collapsed {
            max-height: 0;
            overflow: hidden;
        }
        
        .collapsible-toggle {
            font-size: 14px;
            transition: transform 0.3s ease;
        }
        
        .collapsible-toggle.collapsed {
            transform: rotate(-90deg);
        }
        
        body.dark-mode .collapsible-block {
            border-color: #66bb6a;
            background-color: rgba(102, 187, 106, 0.1);
        }
        
        body.dark-mode .collapsible-header {
            background: linear-gradient(45deg, #66bb6a, #4caf50);
        }
        
        body.dark-mode .collapsible-header:hover {
            background: linear-gradient(45deg, #4caf50, #66bb6a);
        }
        
        body.dark-mode .collapsible-content {
            background-color: rgba(102, 187, 106, 0.05);
        }

        /* Dark Mode Toggle Button */
        .dark-mode-toggle {
            background: linear-gradient(45deg, #2d2d2d, #404040);
            color: #ffffff;
            border: 2px solid #555;
            padding: 12px 16px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        .dark-mode-toggle:hover {
            background: linear-gradient(45deg, #404040, #2d2d2d);
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .dark-mode-toggle:active {
            transform: scale(0.95);
        }

        body.dark-mode .dark-mode-toggle {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-color: #667eea;
        }

        body.dark-mode .dark-mode-toggle:hover {
            background: linear-gradient(45deg, #764ba2, #667eea);
        }

        /* Navigation Buttons */
        .navigation {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .nav-btn.active:hover {
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        body.dark-mode .navigation {
            background: #3d3d3d;
        }

        body.dark-mode .nav-btn {
            background: linear-gradient(135deg, #4d4d4d 0%, #5d5d5d 100%);
        }

        body.dark-mode .nav-btn:hover {
            background: linear-gradient(135deg, #5d5d5d 0%, #6d6d6d 100%);
        }

        body.dark-mode .nav-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="status-led" id="statusLed" title="×¡×˜×˜×•×¡ ×—×™×‘×•×¨ ×œ×©×¨×ª - ×œ×—×¥ ×œ×¤×¨×˜×™×"></div>
                <h1 title="×§×•× ×¡×•×œ ×”×©×¨×ª - ×”×¦×’×ª ×›×œ ×”×œ×•×’×™× ×•×”×”×•×“×¢×•×ª ××”×©×¨×ª ×‘×–××Ÿ ×××ª">ğŸ–¥ï¸ CONSOLE - ×¤×œ×˜ ×”×§×•× ×¡×•×œ</h1>
            </div>
            <div class="header-center">
                <a href="/" class="nav-btn" title="× ×™×”×•×œ ××™×™×œ×™× - ×”×¦×’×ª ×•× ×™×”×•×œ ×›×œ ×”××™×™×œ×™× ×¢× × ×™×ª×•×— AI ×•×—×™×©×•×‘ ×¦×™×•× ×™ ×—×©×™×‘×•×ª">
                    ğŸ“§ × ×™×”×•×œ ××™×™×œ×™×
                </a>
                <a href="/meetings" class="nav-btn" title="× ×™×”×•×œ ×¤×’×™×©×•×ª - ×”×¦×’×ª ×•× ×™×”×•×œ ×›×œ ×”×¤×’×™×©×•×ª ×¢× × ×™×ª×•×— AI ×•×—×™×©×•×‘ ×¦×™×•× ×™ ×—×©×™×‘×•×ª">
                    ğŸ“… × ×™×”×•×œ ×¤×’×™×©×•×ª
                </a>
                <a href="/consol" class="nav-btn active" title="×§×•× ×¡×•×œ - ×”×¦×’×ª ×›×œ ×”×œ×•×’×™× ×•×”×”×•×“×¢×•×ª ××”×©×¨×ª ×‘×–××Ÿ ×××ª">
                    ğŸ–¥ï¸ ×§×•× ×¡×•×œ
                </a>
                <a href="/learning-management" class="nav-btn" title="× ×™×”×•×œ ×œ××™×“×” - ×”×¦×’×ª ×¡×˜×˜×™×¡×˜×™×§×•×ª ×œ××™×“×”, ×“×¤×•×¡×™ ×—×©×™×‘×•×ª ×•×”×’×“×¨×•×ª ××©×ª××©">
                    ğŸ§  × ×™×”×•×œ ×œ××™×“×”
                </a>
            </div>
            <div class="header-right">
                <button onclick="toggleAutoScroll()" class="auto-scroll-btn" id="autoScrollBtn" title="×¢×¦×™×¨×ª ×’×œ×™×œ×” ××•×˜×•××˜×™×ª - ×¢×¦×•×¨ ××• ×”×¤×¢×œ ×’×œ×™×œ×” ××•×˜×•××˜×™×ª ×©×œ ×”×§×•× ×¡×•×œ">â¸ï¸ ×¢×¦×™×¨×ª ×’×œ×™×œ×”</button>
                <button onclick="resetConsole()" class="reset-console-btn" title="××™×¤×•×¡ ×§×•× ×¡×•×œ - × ×§×” ××ª ×›×œ ×”×œ×•×’×™× ××”×©×¨×ª ×•××”×ª×¦×•×’×” ×•×˜×¢×Ÿ ××—×“×©">ğŸ”„ ××ª×—×•×œ ×§×•× ×¡×•×œ</button>
                <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="×”×—×œ×£ ×‘×™×Ÿ ×¢×¨×›×” ×›×”×” ×œ×¢×¨×›×” ×‘×”×™×¨×”">ğŸŒ™</button>
            </div>
        </div>
    </div>

    <div class="navigation">
        <button onclick="restartServer()" class="restart-btn" title="×”×¤×¢×œ ×©×¨×ª ××—×“×© - ×”×¤×¢×œ ××ª quick_start.ps1 ××—×“×©">ğŸš€ ××ª×—×•×œ ×©×¨×ª</button>
        <button onclick="toggleBackupSection()" class="backup-btn" title="×¦×•×¨ ×’×™×‘×•×™ ××œ× - ×™×•×¦×¨ ×¤×¨×•××¤×˜×™×, ×ª×™×¢×•×“ ×•×’×™×‘×•×™ ZIP ×¢× ×”×›×œ">ğŸ“¦ ×’×™×‘×•×™ ××œ×</button>
        <button onclick="setupOutlookAddin()" class="outlook-addin-btn" title="×ª×•×¡×£ ×œ-Outlook - ×™×¦×•×¨ ×¢××•×“×ª AIScore ×‘-Outlook">ğŸ”Œ ×ª×•×¡×£ Outlook</button>
        <button onclick="transferScoresToOutlook()" class="transfer-scores-btn" title="×”×¢×‘×¨×ª ×¦×™×•× ×™× ×œ-Outlook - ×”×¢×‘×¨ ××ª ×›×œ ×”×¦×™×•× ×™× ××”××¤×œ×™×§×¦×™×” ×œ××™×™×œ×™× ×‘-Outlook">ğŸ“Š ×”×¢×‘×¨×ª ×¦×™×•× ×™×</button>
        <button onclick="copyConsoleText()" class="copy-console-btn" title="×”×¢×ª×§ ×˜×§×¡×˜ ××”×§×•× ×¡×•×œ - ×”×¢×ª×§ ××ª ×›×œ ×”×˜×§×¡×˜ ××”×§×•× ×¡×•×œ ×œ×œ×•×—">ğŸ“‹ ×”×¢×ª×§ ×§×•× ×¡×•×œ</button>
    </div>

    <!-- ×©×“×” ×”×¡×‘×¨ ×’×¨×¡×” (× ×¡×ª×¨ ×‘×”×ª×—×œ×”) -->
    <div id="backup-section" class="backup-section" style="display: none;">
        <input type="text" id="version-description" placeholder="×”×¡×‘×¨ ×¢×œ ×”×’×¨×¡×” (××•×¤×¦×™×•× ×œ×™)" class="version-input" maxlength="50">
        <div class="backup-actions">
            <button onclick="createBackup()" class="confirm-backup-btn" title="××©×¨ ×™×¦×™×¨×ª ×’×™×‘×•×™">âœ… ××©×¨ ×’×™×‘×•×™</button>
            <button onclick="cancelBackup()" class="cancel-backup-btn" title="×‘×˜×œ ×™×¦×™×¨×ª ×’×™×‘×•×™">âŒ ×‘×˜×œ</button>
        </div>
    </div>

    <div id="console-output" class="console-output" title="××–×•×¨ ×”×œ×•×’×™× - ××¦×™×’ ××ª ×›×œ ×”×”×•×“×¢×•×ª ×•×”×œ×•×’×™× ××”×©×¨×ª ×¢× ×¦×‘×¢×™× ×©×•× ×™× ×œ×¤×™ ×¡×•×’ ×”×”×•×“×¢×”">
        <div class="log-entry INFO">[×××ª×™×Ÿ] ×××ª×™×Ÿ ×œ×—×™×‘×•×¨ ×œ×©×¨×ª...</div>
    </div>

    <script>
        // Version: 2025-10-01-23:00 - Fixed log refresh with lastLogIndex
        let autoScroll = true;
        let refreshInterval;
        let currentServerId = null; // ××–×”×” ×”×©×¨×ª ×”× ×•×›×—×™

        function scrollToBottom() {
            const consoleOutput = document.getElementById('consoleOutput');
            if (consoleOutput) {
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            }
        }

        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            const btn = document.getElementById('autoScrollBtn');
            
            if (autoScroll) {
                btn.textContent = 'â¸ï¸ ×¢×¦×™×¨×ª ×’×œ×™×œ×”';
                btn.classList.remove('active');
                btn.title = '×¢×¦×™×¨×ª ×’×œ×™×œ×” ××•×˜×•××˜×™×ª - ×¢×¦×•×¨ ××• ×”×¤×¢×œ ×’×œ×™×œ×” ××•×˜×•××˜×™×ª ×©×œ ×”×§×•× ×¡×•×œ';
            } else {
                btn.textContent = 'â–¶ï¸ ×”×¤×¢×œ×ª ×’×œ×™×œ×”';
                btn.classList.add('active');
                btn.title = '×”×¤×¢×œ×ª ×’×œ×™×œ×” ××•×˜×•××˜×™×ª - ×¢×¦×•×¨ ××• ×”×¤×¢×œ ×’×œ×™×œ×” ××•×˜×•××˜×™×ª ×©×œ ×”×§×•× ×¡×•×œ';
            }
            
            // ×× ×”×¤×¢×œ× ×• ×’×œ×™×œ×”, ×’×œ×•×œ ××™×“ ×œ×ª×—×ª×™×ª
            if (autoScroll) {
                scrollToBottom();
            }
        }

        function showStatus(message, type = 'info') {
            const statusLed = document.getElementById('statusLed');
            statusLed.className = `status-led ${type}`;
            statusLed.title = `×¡×˜×˜×•×¡ ×—×™×‘×•×¨ ×œ×©×¨×ª: ${message}`;
            
            // ×× ×–×” ×©×’×™××”, ×”×’×“×¨ ××ª ×”× ×•×¨×” ×œ××¦×‘ ×× ×•×ª×§
            if (type === 'error') {
                statusLed.className = 'status-led disconnected';
            } else if (type === 'success') {
                // ×× ×–×” ×”×¦×œ×—×”, ×”×’×“×¨ ××ª ×”× ×•×¨×” ×œ××¦×‘ ××—×•×‘×¨
                statusLed.className = 'status-led connected';
            }
            
            // ×”×•×¡×¤×ª ×”×•×“×¢×” ×§×‘×•×¢×” ×œ×§×•× ×¡×•×œ ×¢× ××™×™×§×•×Ÿ
            let icon = '';
            if (type === 'success') icon = 'âœ…';
            else if (type === 'error') icon = 'âŒ';
            else if (type === 'warning') icon = 'âš ï¸';
            else icon = 'â„¹ï¸';
            
            addLogEntry(`${icon} ${message}`);
        }

        function showRefreshStatus(message) {
            // ×”×¦×’×ª ×”×•×“×¢×” ×©×§×•×¤×¦×ª ×œ×™×“ ×›×¤×ª×•×¨ ×”×’×œ×™×œ×” ×”××•×˜×•××˜×™×ª
            const autoScrollBtn = document.getElementById('autoScrollBtn');
            if (autoScrollBtn) {
                const originalTitle = autoScrollBtn.title;
                autoScrollBtn.title = `ğŸ”„ ${message}`;
                
                // ×”×—×–×¨×ª ×”×›×•×ª×¨×ª ×”××§×•×¨×™×ª ××—×¨×™ 2 ×©× ×™×•×ª
                setTimeout(() => {
                    autoScrollBtn.title = originalTitle;
                }, 2000);
            }
        }

        function toggleStatusLed() {
            const statusLed = document.getElementById('statusLed');
            const currentClass = statusLed.className;
            
            if (currentClass.includes('connected')) {
                showStatus('×× ×•×ª×§ ××”×©×¨×ª', 'disconnected');
            } else if (currentClass.includes('disconnected')) {
                showStatus('××ª×—×‘×¨ ×œ×©×¨×ª...', 'loading');
                setTimeout(() => {
                    showStatus('××—×•×‘×¨ ×œ×©×¨×ª', 'connected');
                }, 1000);
            } else {
                showStatus('××—×•×‘×¨ ×œ×©×¨×ª', 'connected');
            }
        }

        // ×”×•×¡×¤×ª event listener ×œ× ×•×¨×”
        document.addEventListener('DOMContentLoaded', function() {
            const statusLed = document.getElementById('statusLed');
            if (statusLed) {
                statusLed.addEventListener('click', toggleStatusLed);
                // ×”×’×“×¨×ª ×”× ×•×¨×” ×›××—×•×‘×¨×ª ×›×‘×¨ ××”×”×ª×—×œ×”
                showStatus('××—×•×‘×¨ ×œ×©×¨×ª', 'connected');
            }
        });

        function addLogEntry(logText) {
            const consoleOutput = document.getElementById('console-output');
            
            // ×”×’×‘×œ×” ×¢×œ ××¡×¤×¨ ×”×œ×•×’×™× ×›×“×™ ×œ×× ×•×¢ ×ª×§×™×¢×•×ª - ×”×’×“×œ×” ×œ-500
            const maxLogs = 500;
            if (consoleOutput.children.length > maxLogs) {
                // ××—×§ ×¨×§ ××ª ×”×œ×•×’×™× ×”×™×©× ×™× ×‘×™×•×ª×¨
                while (consoleOutput.children.length > maxLogs) {
                    consoleOutput.removeChild(consoleOutput.firstChild);
                }
            }
            
            // ×˜×™×¤×•×œ ×‘××•×‘×™×™×§×˜×™× - ×× ×–×” ××•×‘×™×™×§×˜, × ×¡×” ×œ×—×œ×¥ ××ª ×”×”×•×“×¢×”
            if (typeof logText === 'object' && logText !== null) {
                if (logText.message) {
                    logText = logText.message;
                } else if (logText.text) {
                    logText = logText.text;
                } else if (logText.content) {
                    logText = logText.content;
                } else {
                    // ×× ×–×” ××•×‘×™×™×§×˜ ×œ×œ× ×©×“×” ×‘×¨×•×¨, ×œ× ×œ×”×¦×™×’
                    return;
                }
            }
            
            // ×•×™×“×•× ×©-logText ×”×•× ××—×¨×•×–×ª
            if (typeof logText !== 'string') {
                logText = String(logText);
            }
            
            // ×‘×“×™×§×” ×× ×”×”×•×“×¢×” ×¨×™×§×” ××• ×œ× ×‘×¨×•×¨×” - ×œ× ×œ×”×¦×™×’
            if (!logText || logText.trim() === '' || logText === 'undefined' || logText === 'null' || logText === 'NaN' || logText.match(/^=+$/)) {
                return;
            }
            
            // ×‘×“×™×§×” ×× ×–×” ×œ×•×’ ×—×•×–×¨ ×©×¦×¨×™×š ×œ×”×™×•×ª collapsible
            if (isRepeatingLog(logText)) {
                console.log('DEBUG: Creating collapsible block for:', logText);
                addToCollapsibleBlock(logText, consoleOutput);
                return;
            }
            
            // ×‘×“×™×§×” ×× ×¦×¨×™×š ×œ×™×¦×•×¨ ×‘×œ×•×§ collapsible ×—×“×© ×œ×¤×¢×•×œ×” ××©××¢×•×ª×™×ª
            if (shouldCreateCollapsibleBlock(logText)) {
                console.log('DEBUG: Creating significant collapsible block for:', logText);
                createNewCollapsibleBlock(logText, consoleOutput);
                return;
            }
            
            // ×‘×“×™×§×” ×× ×–×” ×¡×™×•× ×©×œ ×¤×¢×•×œ×” ××©××¢×•×ª×™×ª - ×¢×“×›×•×Ÿ ×”×‘×œ×•×§ ×”××—×¨×•×Ÿ
            if (isEndOfSignificantAction(logText)) {
                updateLastCollapsibleBlock(logText, consoleOutput);
                return;
            }
            
            // ×‘×“×™×§×” ×× ×”×©×•×¨×” ×”× ×•×›×—×™×ª ××ª××™××” ×œ×¤×¢×•×œ×” ×‘×‘×œ×•×§ ×”××—×¨×•×Ÿ
            if (shouldAddToLastCollapsibleBlock(logText)) {
                addToLastCollapsibleBlock(logText, consoleOutput);
                return;
            }
            
            const logEntry = document.createElement('div');
            
            // ×–×™×”×•×™ ×¨××ª ×”×œ×•×’ ×•×”×•×¡×¤×ª ××™×™×§×•×Ÿ
            let logClass = 'INFO';
            let icon = 'â„¹ï¸';
            let displayText = logText;
            
            if (logText.includes('ERROR') || logText.includes('×©×’×™××”') || logText.includes('âŒ')) {
                logClass = 'ERROR';
                icon = 'âŒ';
                // ×”×¡×¨×ª ×”××™×œ×” ERROR ××”×˜×§×¡×˜
                displayText = logText.replace(/^ERROR:\s*/, '').replace(/ERROR\s*/, '');
            } else if (logText.includes('SUCCESS') || logText.includes('×”×•×©×œ×') || logText.includes('âœ…')) {
                logClass = 'SUCCESS';
                icon = 'âœ…';
                // ×”×¡×¨×ª ×”××™×œ×” SUCCESS ××”×˜×§×¡×˜
                displayText = logText.replace(/^SUCCESS:\s*/, '').replace(/SUCCESS\s*/, '');
            } else if (logText.includes('WARNING') || logText.includes('××–×”×¨×”') || logText.includes('âš ï¸')) {
                logClass = 'WARNING';
                icon = 'âš ï¸';
                // ×”×¡×¨×ª ×”××™×œ×” WARNING ××”×˜×§×¡×˜
                displayText = logText.replace(/^WARNING:\s*/, '').replace(/WARNING\s*/, '');
            } else if (logText.includes('INFO') || logText.includes('××™×“×¢') || logText.includes('â„¹ï¸')) {
                logClass = 'INFO';
                icon = 'â„¹ï¸';
                // ×”×¡×¨×ª ×”××™×œ×” INFO ××”×˜×§×¡×˜
                displayText = logText.replace(/^INFO:\s*/, '').replace(/INFO\s*/, '');
            }
            
            // ×”×•×¡×¤×ª timestamp ×× ×§×™×™×
            const timestampFromArg = arguments[1]; // timestamp ××”×¤×¨××˜×¨ ×”×©× ×™
            let finalText = '';
            
            // ×× ×”×”×•×“×¢×” ×›×‘×¨ ×™×© ×œ×” ××™×™×§×•×Ÿ, ×œ× ×œ×”×•×¡×™×£ ×¢×•×“ ××—×“
            if (displayText.match(/^[âœ…âŒâš ï¸â„¹ï¸ğŸš€ğŸ“ŠğŸ”ŒğŸ“šğŸ“ğŸ“„ğŸ“‹ğŸ”„â³]/)) {
                finalText = displayText;
            } else {
                // ×”×•×¡×¤×ª ××™×™×§×•×Ÿ ×¨×§ ×× ×”×”×•×“×¢×” ×œ× ××ª×—×™×œ×” ×‘××™×™×§×•×Ÿ
                finalText = `${icon} ${displayText}`;
            }
            
            // ×”×•×¡×¤×ª timestamp ×‘×ª×—×™×œ×ª ×”×”×•×“×¢×” ×¢× HTML
            if (timestampFromArg) {
                logEntry.innerHTML = `<span class="timestamp">[${timestampFromArg}]</span> ${finalText}`;
            } else {
                logEntry.textContent = finalText;
            }
            
            logEntry.className = `log-entry ${logClass}`;
            consoleOutput.appendChild(logEntry);
            if (logClass === 'ERROR') {
                logEntry.title = '×”×•×“×¢×ª ×©×’×™××” - ×‘×¢×™×” ×©×“×•×¨×©×ª ×ª×©×•××ª ×œ×‘ ××™×™×“×™×ª';
            } else if (logClass === 'SUCCESS') {
                logEntry.title = '×”×•×“×¢×ª ×”×¦×œ×—×” - ×¤×¢×•×œ×” ×”×•×©×œ××” ×‘×”×¦×œ×—×”';
            } else if (logClass === 'WARNING') {
                logEntry.title = '×”×•×“×¢×ª ××–×”×¨×” - ×‘×¢×™×” ×¤×•×˜× ×¦×™××œ×™×ª ×©×›×“××™ ×œ×‘×“×•×§';
            } else {
                logEntry.title = '×”×•×“×¢×ª ××™×“×¢ - ××™×“×¢ ×›×œ×œ×™ ×¢×œ ×¤×¢×•×œ×•×ª ×”××¢×¨×›×ª';
            }
            
            consoleOutput.appendChild(logEntry);
            
            // ×’×œ×™×œ×” ××•×˜×•××˜×™×ª
            if (autoScroll) {
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            }
        }

        function isRepeatingLog(logText) {
            // ×‘×“×™×§×” ×× ×–×” ×œ×•×’ ×—×•×–×¨ - × ×‘×“×•×§ ×× ×”×©×•×¨×” ×”× ×•×›×—×™×ª ×“×•××” ×œ×§×•×“××ª
            const consoleOutput = document.getElementById('console-output');
            const lastEntry = consoleOutput.lastElementChild;
            
            if (!lastEntry) return false;
            
            // ×‘×“×™×§×” ×× ×”×©×•×¨×” ×”× ×•×›×—×™×ª ×”×™× ××¡×•×’ ×©××ª××™× ×œ-collapsible
            // × ×¡×™×¨ ××™×§×•× ×™× ×•×–××Ÿ ×•× ×‘×“×•×§ ××ª ×”×ª×•×›×Ÿ
            const cleanText = logText.replace(/\[\d+:\d+:\d+\]\s*\d+:\s*/, '').trim();
            const cleanTextNoEmoji = cleanText.replace(/[^\u0000-\u007F]/g, '').trim(); // ×”×¡×¨×ª ××™×§×•× ×™×
            const firstWord = cleanTextNoEmoji.split(' ')[0];
            
            // ×‘×“×™×§×” ×× ×–×” ×¡×•×’ ×œ×•×’ ×©××ª××™× ×œ-collapsible
            const collapsibleTypes = ['Server', 'Quick', 'Working', 'Stopping', 'Checking', 'Installing', 'Starting', 'Trying', 'Basic', 'Outlook', 'AI', 'CONSOL', 'Loading', 'Searching', 'Found', 'Loaded', 'Error', 'Analyzing', 'Smart', 'Completed', 'Calculating', 'Returning', '××—×•×‘×¨', '×¨×¢× ×•×Ÿ', '××ª×—×™×œ', '× ××¦××•', '× ×˜×¢× ×•', '× ×™×ª×—', '×”×•×©×œ××”', '×”×¢×‘×¨×ª', '×¦×™×•× ×™×', '×—×™×©×•×‘'];
            
            if (!collapsibleTypes.some(type => firstWord.includes(type))) {
                return false; // ×œ× ××ª××™× ×œ-collapsible
            }
            
            // ×× ×”×©×•×¨×” ×”×§×•×“××ª ×”×™× ×‘×œ×•×§ collapsible, × ×‘×“×•×§ ×× ×”×©×•×¨×” ×”× ×•×›×—×™×ª ×“×•××” ×œ×ª×•×›×Ÿ ×©×œ×•
            if (lastEntry.classList.contains('collapsible-block')) {
                const content = lastEntry.querySelector('.collapsible-content');
                const firstLogEntry = content.querySelector('.log-entry');
                if (firstLogEntry) {
                    return isSimilarLog(logText, firstLogEntry.textContent);
                }
            }
            
            // ×‘×“×™×§×” ×× ×”×©×•×¨×” ×”× ×•×›×—×™×ª ×“×•××” ×œ×§×•×“××ª
            return isSimilarLog(logText, lastEntry.textContent);
        }
        
        function shouldCreateCollapsibleBlock(logText) {
            // ×‘×“×™×§×” ×× ×¦×¨×™×š ×œ×™×¦×•×¨ ×‘×œ×•×§ collapsible ×—×“×© ×œ×¤×¢×•×œ×” ××©××¢×•×ª×™×ª
            const cleanText = logText.replace(/\[\d+:\d+:\d+\]\s*\d+:\s*/, '').trim();
            const cleanTextNoEmoji = cleanText.replace(/[^\u0000-\u007F]/g, '').trim();
            
            // ×¤×¢×•×œ×•×ª ××©××¢×•×ª×™×•×ª ×©×¦×¨×™×›×•×ª ×‘×œ×•×§ collapsible
            const significantActions = [
                'Loading emails',
                'Searching all emails',
                'Found emails',
                'Loading meetings',
                'Analyzing emails',
                'Starting smart analysis',
                'Smart logic:',
                'Completed smart analysis',
                'Calculating email statistics',
                'Calculating meeting statistics',
                'Initial data loading completed',
                'Server restarting',
                'Quick Start',
                '×”×¢×‘×¨×ª ×¦×™×•× ×™×',
                'Transferring grades',
                'Grade transfer',
                '×—×™×©×•×‘ ×¡×˜×˜×™×¡×˜×™×§×•×ª',
                'Starting Outlook Email Manager',
                'Trying to connect to Outlook',
                'Starting web server',
                'Starting initial data loading',
                '××ª×—×™×œ ×˜×¢×™× ×ª ××™×™×œ×™×',
                '××ª×—×™×œ ×˜×¢×™× ×ª ×¤×’×™×©×•×ª',
                '× ×™×ª×— ××™×™×œ×™×',
                '×”×•×©×œ××” × ×™×ª×•×—',
                '× ×˜×¢× ×• ×¤×’×™×©×•×ª',
                '× ××¦××• ×¤×’×™×©×•×ª'
            ];
            
            // ×‘×“×™×§×” ×× ×”×©×•×¨×” ×”× ×•×›×—×™×ª ××ª×—×™×œ×” ×‘×¤×¢×•×œ×” ××©××¢×•×ª×™×ª
            return significantActions.some(action => 
                cleanTextNoEmoji.toLowerCase().includes(action.toLowerCase()) ||
                cleanText.toLowerCase().includes(action.toLowerCase())
            );
        }
        
        function isSimilarLog(logText1, logText2) {
            // ×‘×“×™×§×” ×× ×©× ×™ ×”×œ×•×’×™× ×“×•××™× ××¡×¤×™×§ ×›×“×™ ×œ×”×™×•×ª ×‘××•×ª×• ×‘×œ×•×§
            if (!logText1 || !logText2) return false;
            
            // × ×™×§×•×™ ×”×–××Ÿ ×•×”××™×§×•× ×™×
            const clean1 = logText1.replace(/\[\d+:\d+:\d+\]\s*\d+:\s*/, '').trim();
            const clean2 = logText2.replace(/\[\d+:\d+:\d+\]\s*\d+:\s*/, '').trim();
            
            // ×”×¡×¨×ª ××™×§×•× ×™×
            const clean1NoEmoji = clean1.replace(/[^\u0000-\u007F]/g, '').trim();
            const clean2NoEmoji = clean2.replace(/[^\u0000-\u007F]/g, '').trim();
            
            // ×‘×“×™×§×” ×× ×”× ×“×•××™×
            return clean1NoEmoji.toLowerCase().includes(clean2NoEmoji.toLowerCase()) ||
                   clean2NoEmoji.toLowerCase().includes(clean1NoEmoji.toLowerCase());
        }

        function addToCollapsibleBlock(logText, consoleOutput) {
            // ×‘×“×™×§×” ×× ×”×©×•×¨×” ×”× ×•×›×—×™×ª ×”×™× ×—×œ×§ ××‘×œ×•×§ ×§×™×™×
            const lastEntry = consoleOutput.lastElementChild;
            
            if (lastEntry && lastEntry.classList.contains('collapsible-block')) {
                // ×”×•×¡×¤×ª ×ª×•×›×Ÿ ×œ×‘×œ×•×§ ×”×§×™×™×
                const content = lastEntry.querySelector('.collapsible-content');
                if (content) {
                    const logEntry = document.createElement('div');
                    logEntry.textContent = logText;
                    // ×¡×™×•×•×’ ×¨××ª ×”×œ×•×’ ××ª×•×š ×”×˜×§×¡×˜
                    if (/\bERROR\b|×©×’×™××”/.test(logText)) {
                        logEntry.className = 'log-entry ERROR';
                    } else if (/\bWARNING\b|××–×”×¨×”/.test(logText)) {
                        logEntry.className = 'log-entry WARNING';
                    } else if (/\bSUCCESS\b|×”×•×©×œ××”|×”×•×©×œ×|×”×¦×œ×—×”/.test(logText)) {
                        logEntry.className = 'log-entry SUCCESS';
                    } else {
                        logEntry.className = 'log-entry INFO';
                    }
                    content.appendChild(logEntry);
                    
                    // ×× ×”×‘×œ×•×§ ×§×•×¨×¡, × ×¤×ª×— ××•×ª×•
                    if (content.classList.contains('collapsed')) {
                        content.classList.remove('collapsed');
                        const toggle = lastEntry.querySelector('.collapsible-toggle');
                        if (toggle) {
                            toggle.textContent = 'â–¼';
                            toggle.classList.remove('collapsed');
                        }
                    }
                    return;
                }
            }
            
            // ×× ×œ× × ××¦× ×‘×œ×•×§ ×§×™×™×, × ×•×¡×™×£ log entry ×¨×’×™×œ
            const logEntry = document.createElement('div');
            logEntry.textContent = logText;
            if (/\bERROR\b|×©×’×™××”/.test(logText)) {
                logEntry.className = 'log-entry ERROR';
            } else if (/\bWARNING\b|××–×”×¨×”/.test(logText)) {
                logEntry.className = 'log-entry WARNING';
            } else if (/\bSUCCESS\b|×”×•×©×œ××”|×”×•×©×œ×|×”×¦×œ×—×”/.test(logText)) {
                logEntry.className = 'log-entry SUCCESS';
            } else {
                logEntry.className = 'log-entry INFO';
            }
            consoleOutput.appendChild(logEntry);
        }

        function createCollapsibleBlock(id, title, parent, timestamp = null) {
            const block = document.createElement('div');
            block.id = id;
            block.className = 'collapsible-block';
            
            const header = document.createElement('div');
            header.className = 'collapsible-header';
            
            // ×”×•×¡×¤×ª timestamp ×× ×§×™×™×
            const timestampHTML = timestamp ? `<span class="timestamp">[${timestamp}]</span> ` : '';
            
            header.innerHTML = `
                ${timestampHTML}<span class="header-text">${title}</span>
                <span class="repeat-count"></span>
                <span class="collapsible-toggle">â–¼</span>
            `;
            
            const content = document.createElement('div');
            content.className = 'collapsible-content';
            
            block.appendChild(header);
            block.appendChild(content);
            parent.appendChild(block);
            
            // ×”×•×¡×¤×ª event listener
            header.addEventListener('click', function() {
                const isCollapsed = content.classList.contains('collapsed');
                const toggle = header.querySelector('.collapsible-toggle');
                
                if (isCollapsed) {
                    content.classList.remove('collapsed');
                    toggle.textContent = 'â–¼';
                    toggle.classList.remove('collapsed');
                } else {
                    content.classList.add('collapsed');
                    toggle.textContent = 'â–¶';
                    toggle.classList.add('collapsed');
                }
            });
            
            return block;
        }
        
        function createNewCollapsibleBlock(logText, consoleOutput) {
            // ×™×¦×™×¨×ª ×‘×œ×•×§ collapsible ×—×“×© ×œ×¤×¢×•×œ×” ××©××¢×•×ª×™×ª
            const cleanText = logText.replace(/\[\d+:\d+:\d+\]\s*\d+:\s*/, '').trim();
            const cleanTextNoEmoji = cleanText.replace(/[^\u0000-\u007F]/g, '').trim();
            
            // ×§×‘×™×¢×ª ×›×•×ª×¨×ª ×”×‘×œ×•×§ ×œ×¤×™ ×¡×•×’ ×”×¤×¢×•×œ×”
            let headerText = '';
            if (
                cleanTextNoEmoji.toLowerCase().includes('loading emails') ||
                cleanTextNoEmoji.toLowerCase().includes('searching all emails') ||
                (cleanTextNoEmoji.toLowerCase().includes('found') && cleanTextNoEmoji.toLowerCase().includes('emails')) ||
                cleanText.includes('××—×¤×©') && cleanText.includes('××™×™×œ') ||
                cleanText.includes('× ××¦××•') && cleanText.includes('××™×™×œ') ||
                cleanText.includes('×˜×•×¢×Ÿ') && cleanText.includes('××™×™×œ')
            ) {
                headerText = 'ğŸ“§ ×˜×¢×™× ×ª ××™×™×œ×™× ×â€‘Outlook';
            } else if (
                cleanTextNoEmoji.toLowerCase().includes('starting smart analysis') ||
                cleanTextNoEmoji.toLowerCase().includes('smart logic') ||
                cleanTextNoEmoji.toLowerCase().includes('analyzing emails') ||
                cleanText.includes('× ×™×ª×•×—') && cleanText.includes('××™×™×œ')
            ) {
                headerText = 'ğŸ§  × ×™×ª×•×— ×—×›× ×©×œ ××™×™×œ×™×';
            } else if (cleanTextNoEmoji.toLowerCase().includes('loading meetings')) {
                headerText = 'ğŸ“… ×˜×¢×™× ×ª ×¤×’×™×©×•×ª ×â€‘Outlook';
            } else if (
                cleanTextNoEmoji.toLowerCase().includes('server restarting') ||
                cleanTextNoEmoji.toLowerCase().includes('starting web server') ||
                cleanText.includes('××ª×—×•×œ ×©×¨×ª')
            ) {
                headerText = 'ğŸ”„ ××ª×—×•×œ ×©×¨×ª';
            } else if (
                cleanTextNoEmoji.toLowerCase().includes('starting outlook') ||
                cleanTextNoEmoji.toLowerCase().includes('trying to connect to outlook') ||
                cleanTextNoEmoji.toLowerCase().includes('outlook connection') ||
                cleanText.includes('×—×™×‘×•×¨ ×œ-Outlook') || cleanText.includes('×—×™×‘×•×¨ ×œâ€‘Outlook')
            ) {
                headerText = 'ğŸ”Œ ×—×™×‘×•×¨ ×œâ€‘Outlook';
            } else if (
                cleanTextNoEmoji.toLowerCase().includes('calculating email statistics') ||
                (cleanText.includes('×—×™×©×•×‘') && cleanText.includes('×¡×˜×˜×™×¡×˜×™×§×•×ª') && cleanText.includes('××™×™×œ'))
            ) {
                headerText = 'ğŸ“Š ×—×™×©×•×‘ ×¡×˜×˜×™×¡×˜×™×§×•×ª ××™×™×œ×™×';
            } else if (
                cleanTextNoEmoji.toLowerCase().includes('calculating meeting statistics') ||
                (cleanText.includes('×—×™×©×•×‘') && cleanText.includes('×¡×˜×˜×™×¡×˜×™×§×•×ª') && cleanText.includes('×¤×’×™×©'))
            ) {
                headerText = 'ğŸ“Š ×—×™×©×•×‘ ×¡×˜×˜×™×¡×˜×™×§×•×ª ×¤×’×™×©×•×ª';
            } else if (
                cleanTextNoEmoji.toLowerCase().includes('initial data loading') ||
                cleanTextNoEmoji.toLowerCase().includes('starting initial data loading') ||
                cleanText.includes('×˜×¢×™× ×ª × ×ª×•× ×™× ×¨××©×•× ×™×ª')
            ) {
                headerText = 'ğŸš€ ×˜×¢×™× ×ª × ×ª×•× ×™× ×¨××©×•× ×™×ª';
            } else if (cleanTextNoEmoji.toLowerCase().includes('×”×¢×‘×¨×ª ×¦×™×•× ×™×') || 
                       cleanTextNoEmoji.toLowerCase().includes('transferring grades') ||
                       cleanTextNoEmoji.toLowerCase().includes('grade transfer')) {
                headerText = 'ğŸ“ ×”×¢×‘×¨×ª ×¦×™×•× ×™×';
            } else if (
                cleanTextNoEmoji.toLowerCase().includes('backup') ||
                cleanText.includes('×’×™×‘×•×™')
            ) {
                headerText = 'ğŸ“¦ ×™×¦×™×¨×ª ×’×™×‘×•×™';
            } else if (
                cleanTextNoEmoji.toLowerCase().includes('prompts') ||
                cleanText.includes('×¤×¨×•××¤×˜')
            ) {
                headerText = 'ğŸ§© ×™×¦×™×¨×ª ×¤×¨×•××¤×˜×™×';
            } else {
                headerText = 'âš™ï¸ ×¤×¢×•×œ×” ××ª×‘×¦×¢×ª';
            }
            
            const block = document.createElement('div');
            block.className = 'collapsible-block';
            
            const header = document.createElement('div');
            header.className = 'collapsible-header';
            header.innerHTML = `
                <span class="toggle-icon">â–¼</span>
                <span class="header-text">${headerText}</span>
                <span class="repeat-count"></span>
            `;
            
            const content = document.createElement('div');
            content.className = 'collapsible-content';
            content.style.display = 'block';
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry INFO';
            logEntry.textContent = logText;
            content.appendChild(logEntry);
            
            block.appendChild(header);
            block.appendChild(content);
            
            // ×”×•×¡×¤×ª event listener ×œ×§×¤×™×œ×”/×¤×ª×™×—×”
            header.addEventListener('click', function() {
                const isCollapsed = content.style.display === 'none';
                content.style.display = isCollapsed ? 'block' : 'none';
                const toggleIcon = header.querySelector('.toggle-icon');
                toggleIcon.textContent = isCollapsed ? 'â–¼' : 'â–¶';
            });
            
            consoleOutput.appendChild(block);
            
            // ×’×œ×™×œ×” ××•×˜×•××˜×™×ª
            if (autoScroll) {
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            }
        }
        
        function isEndOfSignificantAction(logText) {
            // ×‘×“×™×§×” ×× ×–×” ×¡×™×•× ×©×œ ×¤×¢×•×œ×” ××©××¢×•×ª×™×ª
            const cleanText = logText.replace(/\[\d+:\d+:\d+\]\s*\d+:\s*/, '').trim();
            const cleanTextNoEmoji = cleanText.replace(/[^\u0000-\u007F]/g, '').trim();
            
            const endActions = [
                'completed',
                'finished',
                'loaded',
                'analyzed',
                'calculated',
                'initial data loading completed',
                'loaded emails',
                'loaded meetings',
                'completed smart analysis',
                '×”×•×©×œ××”',
                '× ×˜×¢× ×•',
                '× ×™×ª×—',
                '×—×•×©×‘'
            ];
            
            return endActions.some(action => 
                cleanTextNoEmoji.toLowerCase().includes(action.toLowerCase()) ||
                cleanText.toLowerCase().includes(action.toLowerCase())
            );
        }
        
        function updateLastCollapsibleBlock(logText, consoleOutput) {
            // ×¢×“×›×•×Ÿ ×”×‘×œ×•×§ ×”××—×¨×•×Ÿ ×¢× ×”×•×“×¢×ª ×¡×™×•×
            const lastEntry = consoleOutput.lastElementChild;
            if (lastEntry && lastEntry.classList.contains('collapsible-block')) {
                const content = lastEntry.querySelector('.collapsible-content');
                const repeatCount = lastEntry.querySelector('.repeat-count');
                
                // ×”×•×¡×¤×ª ×”×©×•×¨×” ×”× ×•×›×—×™×ª ×œ×ª×•×›×Ÿ
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry INFO';
                logEntry.textContent = logText;
                content.appendChild(logEntry);
                
                // ×¢×“×›×•×Ÿ ×”×¡×˜×˜×•×¡
                if (repeatCount) {
                    repeatCount.textContent = '(×”×•×©×œ×)';
                }
                
                // ×’×œ×™×œ×” ××•×˜×•××˜×™×ª
                if (autoScroll) {
                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                }
            }
        }
        
        function shouldAddToLastCollapsibleBlock(logText) {
            // ×‘×“×™×§×” ×× ×”×©×•×¨×” ×”× ×•×›×—×™×ª ××ª××™××” ×œ×¤×¢×•×œ×” ×‘×‘×œ×•×§ ×”××—×¨×•×Ÿ
            const consoleOutput = document.getElementById('console-output');
            const lastEntry = consoleOutput.lastElementChild;
            
            if (!lastEntry || !lastEntry.classList.contains('collapsible-block')) {
                return false;
            }
            
            const headerText = lastEntry.querySelector('.header-text').textContent;
            const cleanText = logText.replace(/\[\d+:\d+:\d+\]\s*\d+:\s*/, '').trim();
            const cleanTextNoEmoji = cleanText.replace(/[^\u0000-\u007F]/g, '').trim();
            
            // ×‘×“×™×§×” ×× ×”×©×•×¨×” ××ª××™××” ×œ×¤×¢×•×œ×” ×”× ×•×›×—×™×ª
            if (headerText.includes('×˜×¢×™× ×ª ××™×™×œ×™×')) {
                return cleanTextNoEmoji.toLowerCase().includes('loaded') || 
                       cleanTextNoEmoji.toLowerCase().includes('email') ||
                       cleanTextNoEmoji.toLowerCase().includes('found');
            } else if (headerText.includes('× ×™×ª×•×— ××™×™×œ×™×')) {
                return cleanTextNoEmoji.toLowerCase().includes('analyzing') ||
                       cleanTextNoEmoji.toLowerCase().includes('smart') ||
                       cleanTextNoEmoji.toLowerCase().includes('× ×™×ª×—');
            } else if (headerText.includes('×˜×¢×™× ×ª ×¤×’×™×©×•×ª')) {
                return cleanTextNoEmoji.toLowerCase().includes('meeting') ||
                       cleanTextNoEmoji.toLowerCase().includes('calendar') ||
                       cleanTextNoEmoji.toLowerCase().includes('×¤×’×™×©×•×ª');
            } else if (headerText.includes('×”×¤×¢×œ×ª ×©×¨×ª')) {
                return cleanTextNoEmoji.toLowerCase().includes('server') ||
                       cleanTextNoEmoji.toLowerCase().includes('starting') ||
                       cleanTextNoEmoji.toLowerCase().includes('×©×¨');
            } else if (headerText.includes('×—×™×©×•×‘ ×¡×˜×˜×™×¡×˜×™×§×•×ª')) {
                return cleanTextNoEmoji.toLowerCase().includes('calculating') ||
                       cleanTextNoEmoji.toLowerCase().includes('statistics') ||
                       cleanTextNoEmoji.toLowerCase().includes('×—×™×©×•×‘') ||
                       cleanTextNoEmoji.toLowerCase().includes('×¡×˜×˜×™×¡×˜×™×§×•×ª');
            } else if (headerText.includes('×”×¢×‘×¨×ª ×¦×™×•× ×™×')) {
                return cleanTextNoEmoji.toLowerCase().includes('transfer') ||
                       cleanTextNoEmoji.toLowerCase().includes('grade') ||
                       cleanTextNoEmoji.toLowerCase().includes('×”×¢×‘×¨×ª') ||
                       cleanTextNoEmoji.toLowerCase().includes('×¦×™×•× ×™×');
            }
            
            return false;
        }
        
        function addToLastCollapsibleBlock(logText, consoleOutput) {
            // ×”×•×¡×¤×ª ×”×©×•×¨×” ×”× ×•×›×—×™×ª ×œ×‘×œ×•×§ ×”××—×¨×•×Ÿ
            const lastEntry = consoleOutput.lastElementChild;
            if (lastEntry && lastEntry.classList.contains('collapsible-block')) {
                const content = lastEntry.querySelector('.collapsible-content');
                const repeatCount = lastEntry.querySelector('.repeat-count');
                
                // ×”×•×¡×¤×ª ×”×©×•×¨×” ×”× ×•×›×—×™×ª ×œ×ª×•×›×Ÿ
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry INFO';
                logEntry.textContent = logText;
                content.appendChild(logEntry);
                
                // ×¢×“×›×•×Ÿ ××•× ×” ×”×©×•×¨×•×ª
                if (content) {
                    const currentCount = content.querySelectorAll('.log-entry').length;
                    if (repeatCount && typeof repeatCount.textContent !== 'undefined') {
                        // ×”×¦×’×ª ××¦×‘ ×‘×œ×‘×“, ×œ×œ× ××•× ×” ×©×•×¨×•×ª
                        repeatCount.textContent = '';
                    }
                }
                
                // ×’×œ×™×œ×” ××•×˜×•××˜×™×ª
                if (autoScroll) {
                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                }
            }
        }

        // ××•× ×™× ×œ×¢×™×§×•×‘ ×™×¦×™×‘ ××—×¨ ×”×œ×•×’×™× ×©×›×‘×¨ ×”×•×¦×’×•
        window.lastLogIndex = 0;          // ××”×‘×§×© ×œ×©×¨×ª (since)
        window.displayedTotal = 0;        // ×›××” ×œ×•×’×™× ×›×‘×¨ × ×•×¡×¤×• ×œ-DOM ×‘×¤×•×¢×œ
        window.currentBlock = null;       // ×”×‘×œ×•×§ ×”×¤×ª×•×— ×›×¨×’×¢ (×× ×™×©)
        window.USE_CLIENT_BLOCKS = false; // ×‘×™×˜×•×œ ×‘×œ×•×§×™× ×‘×¦×“ ×”×œ×§×•×— â€“ ××©×ª××©×™× ×¨×§ ×‘×©×¨×ª

        function classifyLevel(level, text) {
            if (level === 'ERROR' || /\bERROR\b|×©×’×™××”|âŒ/.test(text || '')) return 'ERROR';
            if (level === 'WARNING' || /\bWARNING\b|××–×”×¨×”|âš ï¸/.test(text || '')) return 'WARNING';
            if (level === 'SUCCESS' || /\bSUCCESS\b|×”×•×©×œ×|×”×•×©×œ××”|âœ…/.test(text || '')) return 'SUCCESS';
            return 'INFO';
        }

        function handleServerBlockLog(log, consoleOutput) {
            if (!consoleOutput) {
                consoleOutput = document.getElementById('console-output');
            }
            if (!log || typeof log !== 'object' || !log.type) {
                return false;
            }
            if (log.type === 'block_start') {
                // ×‘×“×™×§×” ×× ×™×© ×ª×’×™×ª [COLLAPSED] ×‘×›×•×ª×¨×ª
                let title = log.title || '×¤×¢×•×œ×”';
                let isCollapsed = false;
                if (title.startsWith('[COLLAPSED]')) {
                    title = title.replace('[COLLAPSED]', '').trim();
                    isCollapsed = true;
                }
                
                // ×™×¦×™×¨×ª ×‘×œ×•×§ ×—×“×© ×‘×¨×¦×£ ×•×”×¤×™×›×ª×• ×œ×‘×œ×•×§ ×”×¤×¢×™×œ (×¢× timestamp)
                const block = createCollapsibleBlock(log.block_id, title, consoleOutput, log.timestamp);
                block.setAttribute('data-block-id', log.block_id);
                
                // ×× ×™×© ×ª×’×™×ª [COLLAPSED], ×¡×’×•×¨ ××ª ×”×‘×œ×•×§
                if (isCollapsed) {
                    const content = block.querySelector('.collapsible-content');
                    const toggle = block.querySelector('.collapsible-toggle');
                    if (content) {
                        content.classList.add('collapsed');
                    }
                    if (toggle) {
                        toggle.textContent = 'â–¶';
                        toggle.classList.add('collapsed');
                    }
                }
                
                window.currentBlock = block;
                return true;
            }
            if (log.type === 'block_content') {
                // ×”×•×¡×¤×ª ×©×•×¨×•×ª ×¨×§ ×œ×‘×œ×•×§ ×”×¤×¢×™×œ ×›×¨×’×¢
                const block = window.currentBlock;
                if (!block || block.getAttribute('data-block-id') !== log.block_id) {
                    return false; // ×œ× ×‘×œ×•×§ ×”×¤×¢×™×œ â€“ ×œ× ××˜×•×¤×œ ×›××Ÿ
                }
                const content = block.querySelector('.collapsible-content');
                if (!content) return false;
                const div = document.createElement('div');
                const level = classifyLevel(log.level, log.message);
                div.className = `log-entry ${level}`;
                
                // ×”×•×¡×¤×ª timestamp ×œ×›×œ ×©×•×¨×”
                const timestamp = log.timestamp || '';
                const timestampSpan = timestamp ? `<span class="timestamp">[${timestamp}]</span> ` : '';
                div.innerHTML = timestampSpan + (log.message || '');
                
                content.appendChild(div);
                return true;
            }
            if (log.type === 'block_end') {
                // ×¡×’×™×¨×ª ×”×‘×œ×•×§ ×”×¤×¢×™×œ ×•×”××©×š ×œ×¨×¦×£ ×”×‘×
                const block = window.currentBlock;
                if (!block || block.getAttribute('data-block-id') !== log.block_id) {
                    return false;
                }
                const content = block.querySelector('.collapsible-content');
                const header = block.querySelector('.collapsible-header .repeat-count');
                const finalMsg = log.summary || (log.success ? '×”×•×©×œ×' : '× ×›×©×œ');
                const div = document.createElement('div');
                const level = log.success ? 'SUCCESS' : 'ERROR';
                div.className = `log-entry ${level}`;
                
                // ×”×•×¡×¤×ª timestamp ×× ×§×™×™×
                const timestamp = log.timestamp || '';
                if (timestamp) {
                    div.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${finalMsg}`;
                } else {
                    div.textContent = finalMsg;
                }
                
                if (content) content.appendChild(div);
                if (header && typeof header.textContent !== 'undefined') {
                    header.textContent = `(${log.success ? '×”×•×©×œ×' : '× ×›×©×œ'})`;
                }
                window.currentBlock = null;
                return true;
            }
            return false;
        }
        
        function refreshLogs() {
            // ×”×’×‘×œ×” ×¢×œ ×ª×“×™×¨×•×ª ×”×¨×¢× ×•×Ÿ ×›×“×™ ×œ×× ×•×¢ ×ª×§×™×¢×•×ª
            const now = Date.now();
            if (window.lastRefreshTime && (now - window.lastRefreshTime) < 5000) {
                return; // ×œ× ×œ×¨×¢× ×Ÿ ×™×•×ª×¨ ××¤×¢× ×‘-5 ×©× ×™×•×ª
            }
            window.lastRefreshTime = now;
            
            console.log(`[DEBUG] refreshLogs: Requesting logs since index ${window.lastLogIndex}`);
            
            // ×˜×¢×™× ×ª ×¨×§ ×œ×•×’×™× ×—×“×©×™× ××”××™× ×“×§×¡ ×”××—×¨×•×Ÿ
            fetch(`/api/console-logs?since=${window.lastLogIndex}&t=${now}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('×”×©×¨×ª ×œ× ×–××™×Ÿ');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(`[DEBUG] refreshLogs: Received ${data.logs ? data.logs.length : 0} new logs, total=${data.total}, since=${data.since}`);
                    
                    // ×”×•×¡×¤×ª ×¨×§ ×œ×•×’×™× ×—×“×©×™× â€“ ×’× ×× ×”×©×¨×ª ×”×—×–×™×¨ ×©×•×‘ ××ª ×”××—×¨×•× ×™×
                    let newLogs = data.logs || [];
                    const expectedNew = Math.max(0, (data.total || 0) - (window.displayedTotal || 0));
                    if (newLogs.length > expectedNew) {
                        newLogs = newLogs.slice(newLogs.length - expectedNew);
                    }
                    
                    const consoleOutput = document.getElementById('console-output');
                    newLogs.forEach(log => {
                        // ×ª××™×›×” ×‘×œ×•×’×™× ××•× ×—×™ ×©×¨×ª (×‘×œ×•×§×™×)
                        if (typeof log === 'object' && log.type) {
                            const handled = handleServerBlockLog(log, consoleOutput);
                            if (handled) return;
                        }
                        // ×‘×¨×™×¨×ª ××—×“×œ: ×˜×§×¡×˜ ×—×•×¤×©×™ â€“ ×”×œ×™×š ×”×”×©×¢×¨×” ×”×™×©×Ÿ
                        let logText = '';
                        let timestamp = '';
                        if (typeof log === 'object' && log.message) {
                            logText = log.message;
                            timestamp = log.timestamp || '';
                        } else {
                            logText = log;
                        }
                        addLogEntry(logText, timestamp);
                    });

                    // ×¢×“×›×•×Ÿ ×”××•× ×”
                    const oldIndex = window.lastLogIndex;
                    window.lastLogIndex = data.total || window.lastLogIndex;
                    window.displayedTotal = data.total || window.displayedTotal;
                    console.log(`[DEBUG] refreshLogs: Updated lastLogIndex from ${oldIndex} to ${window.lastLogIndex}`);

                    // ×”×¦×’×ª ×”×•×“×¢×” ×¨×§ ×× × ×•×¡×¤×• ×œ×•×’×™× ×—×“×©×™×
                    if (newLogs.length > 0) {
                        showRefreshStatus(`× ×˜×¢× ×• ${newLogs.length} ×œ×•×’×™× ×—×“×©×™×`);
                    }
                })
                .catch(error => {
                    console.error('[DEBUG] refreshLogs: Error -', error);
                    showStatus('×©×’×™××” ×‘×˜×¢×™× ×ª ×œ×•×’×™×: ' + error.message, 'error');
                });
        }

        function clearLogs() {
            showStatus('×× ×§×” ×œ×•×’×™×...', 'info');
            
            fetch('/api/clear-console', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // ×œ× ×œ××—×•×§ ××ª ×”×§×•× ×¡×•×œ - ×¨×§ ×œ×”×•×¡×™×£ ×”×•×“×¢×”
                    addLogEntry('[××—×•×§] ×œ×•×’×™× × ×•×§×• ××”×©×¨×ª');
                    
                    showStatus('×œ×•×’×™× × ×•×§×• ××”×©×¨×ª', 'success');
                } else {
                    showStatus('×©×’×™××” ×‘× ×™×§×•×™ ×œ×•×’×™×: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showStatus('×©×’×™××” ×‘× ×™×§×•×™ ×œ×•×’×™×: ' + error.message, 'error');
            });
        }

        function clearConsole() {
            // ×œ× ×œ××—×•×§ ××ª ×”×§×•× ×¡×•×œ - ×¨×§ ×œ×”×•×¡×™×£ ×”×•×“×¢×”
            addLogEntry('[××—×•×§] ×§×•× ×¡×•×œ × ×•×§×” ×‘×“×£');
        }

        function resetConsole() {
            showStatus('×××¤×¡ ×§×•× ×¡×•×œ...', 'info');
            
            fetch('/api/console-reset', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // ××™×¤×•×¡ ×”×§×•× ×¡×•×œ - ××—×™×§×ª ×›×œ ×”×”×™×¡×˜×•×¨×™×”
                    const consoleOutput = document.getElementById('console-output');
                    consoleOutput.innerHTML = '';
                    
                    // ××™×¤×•×¡ ×”××•× ×”
                    window.lastLogIndex = 0;
                    window.displayedTotal = 0;
                    
                    // ×”×•×¡×¤×ª ×”×•×“×¢×” ×©×”×§×•× ×¡×•×œ ××•×¤×¡
                    addLogEntry('[×××¤×¡] ×§×•× ×¡×•×œ ××•×¤×¡ ××”×©×¨×ª - ×›×œ ×”×”×™×¡×˜×•×¨×™×” × ××—×§×”');
                    addLogEntry('=' * 80);
                    
                    // ×˜×¢×™× ×” ×ª×‘×•×¦×¢ ×‘×¡×‘×‘ ×”×¨×¢× ×•×Ÿ ×”×‘×
                    
                    showStatus('×§×•× ×¡×•×œ ××•×¤×¡ ×‘×”×¦×œ×—×”', 'success');
                } else {
                    showStatus('×©×’×™××” ×‘××™×¤×•×¡ ×§×•× ×¡×•×œ: ' + data.message, 'error');
                }
            })
            .catch(error => {
                showStatus('×©×’×™××” ×‘××™×¤×•×¡ ×§×•× ×¡×•×œ: ' + error.message, 'error');
            });
        }

        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            const btn = document.getElementById('autoScrollBtn');
            if (autoScroll) {
                btn.classList.add('active');
                btn.textContent = 'ğŸ“œ ×’×œ×™×œ×” ××•×˜×•××˜×™×ª (×¤×¢×™×œ)';
            } else {
                btn.classList.remove('active');
                btn.textContent = 'ğŸ“œ ×’×œ×™×œ×” ××•×˜×•××˜×™×ª (×›×‘×•×™)';
            }
        }


        function restartServer() {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×¤×¢×™×œ ××ª ×”×©×¨×ª ××—×“×©?\n×–×” ×™×¡×’×•×¨ ××ª ×”×©×¨×ª ×”× ×•×›×—×™ ×•×™×¤×¢×™×œ ××•×ª×• ××—×“×©.')) {
                showStatus('××¤×¢×™×œ ×©×¨×ª ××—×“×©...', 'info');
                addLogEntry('ğŸš€ ××ª×—×™×œ ×”×¤×¢×œ×ª ×©×¨×ª ××—×“×©...');
                
                // ×©×œ×™×—×” ×‘×§×©×” ×œ×©×¨×ª ×œ×”×¤×¢×™×œ ××—×“×©
                fetch('/api/restart-server', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('×”×©×¨×ª ×œ× ×–××™×Ÿ');
                    }
                    return response.json();
                })
                .then(data => {
                    addLogEntry('âœ… ×‘×§×©×ª ×”×¤×¢×œ×” ××—×“×© × ×©×œ×—×” ×‘×”×¦×œ×—×”');
                    addLogEntry('â³ ×××ª×™×Ÿ ×œ×©×¨×ª ×œ×”×ª×—×™×œ ××—×“×©...');
                    showStatus('×”×©×¨×ª ××ª×—×™×œ ××—×“×©...', 'info');
                    
                    // ×”××ª× ×” 5 ×©× ×™×•×ª ×•××– ×¨×¢× ×•×Ÿ ×”×“×£
                    setTimeout(() => {
                        addLogEntry('ğŸ”„ ××¨×¢× ×Ÿ ××ª ×”×“×£...');
                        window.location.reload();
                    }, 5000);
                })
                .catch(error => {
                    addLogEntry('âŒ ×©×’×™××” ×‘×”×¤×¢×œ×ª ×©×¨×ª ××—×“×©: ' + error.message);
                    showStatus('×©×’×™××” ×‘×”×¤×¢×œ×ª ×©×¨×ª ××—×“×©', 'error');
                });
            }
        }

        function toggleBackupSection() {
            const backupSection = document.getElementById('backup-section');
            if (backupSection.style.display === 'none') {
                backupSection.style.display = 'flex';
                document.getElementById('version-description').focus();
            } else {
                backupSection.style.display = 'none';
                document.getElementById('version-description').value = '';
            }
        }

        function cancelBackup() {
            const backupSection = document.getElementById('backup-section');
            backupSection.style.display = 'none';
            document.getElementById('version-description').value = '';
            showStatus('×™×¦×™×¨×ª ×’×™×‘×•×™ ×‘×•×˜×œ×”', 'info');
        }

        function createDocumentation() {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×™×¦×•×¨/×œ×¨×¢× ×Ÿ ××ª ×§×‘×¦×™ ×”×ª×™×¢×•×“?\n×”×§×‘×¦×™× ×™×™×©××¨×• ×‘×ª×™×§×™×™×ª docs/.')) {
                // ×”×‘×œ×•×§ ×™×•×¦×’ ×¢"×™ ×”×©×¨×ª â€“ ×œ× ××•×¡×™×¤×™× ×œ×•×’×™× ×™×“× ×™×™×
                
                fetch('/api/create-documentation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('×”×©×¨×ª ×œ× ×–××™×Ÿ');
                    }
                    return response.json();
                })
                .then(_ => { /* ×”×‘×œ×•×§ ×›×‘×¨ ××¦×™×’ ×¤×¨×˜×™× */ })
                .catch(error => {
                    addLogEntry('âŒ ×©×’×™××ª ×¨×©×ª ×‘×¨×¢× ×•×Ÿ ×ª×™×¢×•×“: ' + error.message);
                });
            }
        }

        function setupOutlookAddin() {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×’×“×™×¨ ××ª ×ª×•×¡×£ Outlook?\n×–×” ×™×™×¦×•×¨ ×¢××•×“×ª AIScore ×‘-Outlook.')) {
                // ×”×‘×œ×•×§ ×™×•×¦×’ ×¢"×™ ×”×©×¨×ª â€“ ×œ× ××•×¡×™×¤×™× ×œ×•×’×™× ×™×“× ×™×™×
                
                fetch('/api/setup-outlook-addin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('×”×©×¨×ª ×œ× ×–××™×Ÿ');
                    }
                    return response.json();
                })
                .then(_ => { /* ×”×›×œ ×‘×‘×œ×•×§ */ })
                .catch(error => {
                    addLogEntry('âŒ ×©×’×™××ª ×¨×©×ª ×‘×”×’×“×¨×ª ×ª×•×¡×£ Outlook: ' + error.message);
                });
            }
        }

        function transferScoresToOutlook() {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×¢×‘×™×¨ ××ª ×›×œ ×”×¦×™×•× ×™× ×œ-Outlook?\n×–×” ×™×¢×‘×™×¨ ××ª ×›×œ ×”×¦×™×•× ×™× ××”××¤×œ×™×§×¦×™×” ×œ××™×™×œ×™× ×‘-Outlook.')) {
                // ×”×‘×œ×•×§ ×¢×¦××• ×™×™×•×•×¦×¨ ×¢"×™ ×”×©×¨×ª. ×œ× ××•×¡×™×¤×™× ×œ×•×’×™× ×¦×“-×œ×§×•×— ×›×“×™ ×œ×× ×•×¢ ×©×•×¨×•×ª ××—×•×¥ ×œ×‘×œ×•×§.
                fetch('/api/transfer-scores-to-outlook', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('×”×©×¨×ª ×œ× ×–××™×Ÿ');
                    }
                    return response.json();
                })
                .then(data => {
                    // ×œ× ××•×¡×™×¤×™× ×”×•×“×¢×” × ×•×¡×¤×ª â€“ ×”×‘×œ×•×§ ××¦×™×’ ××ª ×”×¡×™×›×•×
                    return;
                })
                .catch(error => {
                    // ×‘××§×¨×” ×›×©×œ ×¨×©×ª, × ×¦×™×’ ×©×•×¨×” ××—×ª ×›×“×™ ×©×œ× × ×™×©××¨ ×‘×œ×™ ××™× ×“×™×§×¦×™×”
                    addLogEntry('âŒ ×©×’×™××” ×›×œ×œ×™×ª ×‘×”×¢×‘×¨×ª ×¦×™×•× ×™×: ' + (error && error.message ? error.message : '×œ× ×™×“×•×¢'));
                });
            }
        }

        function copyConsoleText() {
            const consoleOutput = document.getElementById('console-output');
            const text = consoleOutput.innerText || consoleOutput.textContent;
            
            // × ×™×¡×™×•×Ÿ ×œ×”×¢×ª×™×§ ×œ×œ×•×—
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(() => {
                    showStatus('×˜×§×¡×˜ ×”×•×¢×ª×§ ×œ×œ×•×— ×‘×”×¦×œ×—×”!', 'success');
                    addLogEntry('ğŸ“‹ ×˜×§×¡×˜ ×”×§×•× ×¡×•×œ ×”×•×¢×ª×§ ×œ×œ×•×—');
                }).catch(err => {
                    console.error('×©×’×™××” ×‘×”×¢×ª×§×”:', err);
                    fallbackCopyTextToClipboard(text);
                });
            } else {
                fallbackCopyTextToClipboard(text);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-999999px";
            textArea.style.top = "-999999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showStatus('×˜×§×¡×˜ ×”×•×¢×ª×§ ×œ×œ×•×— ×‘×”×¦×œ×—×”!', 'success');
                    addLogEntry('ğŸ“‹ ×˜×§×¡×˜ ×”×§×•× ×¡×•×œ ×”×•×¢×ª×§ ×œ×œ×•×—');
                } else {
                    showStatus('×©×’×™××” ×‘×”×¢×ª×§×ª ×”×˜×§×¡×˜', 'error');
                    addLogEntry('âŒ ×©×’×™××” ×‘×”×¢×ª×§×ª ×”×˜×§×¡×˜');
                }
            } catch (err) {
                showStatus('×©×’×™××” ×‘×”×¢×ª×§×ª ×”×˜×§×¡×˜: ' + err, 'error');
                addLogEntry('âŒ ×©×’×™××” ×‘×”×¢×ª×§×ª ×”×˜×§×¡×˜: ' + err);
            }
            
            document.body.removeChild(textArea);
        }

        function createCursorPrompts() {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×™×¦×•×¨ ×§×‘×¦×™ ×¤×¨×•××¤×˜×™× ×œ-Cursor?\n×”×§×‘×¦×™× ×™×™×©××¨×• ×‘×ª×™×§×™×™×ª ×”×”×•×¨×“×•×ª.')) {
                // ×”×‘×œ×•×§ ×™×•×¦×’ ×¢"×™ ×”×©×¨×ª â€“ ×œ× ××•×¡×™×¤×™× ×œ×•×’×™× ×™×“× ×™×™×
                
                fetch('/api/create-cursor-prompts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('×”×©×¨×ª ×œ× ×–××™×Ÿ');
                    }
                    return response.json();
                })
                .then(_ => { /* ××•×¦×’ ×‘×ª×•×š ×”×‘×œ×•×§ */ })
                .catch(error => {
                    addLogEntry('âŒ ×©×’×™××ª ×¨×©×ª ×‘×™×¦×™×¨×ª ×¤×¨×•××¤×˜×™×: ' + error.message);
                });
            }
        }

        function createBackup() {
            const versionDescription = document.getElementById('version-description').value.trim();
            
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×™×¦×•×¨ ×’×™×‘×•×™ ××œ× ×©×œ ×”×¤×¨×•×™×§×˜?\n\n×”×ª×”×œ×™×š ×™×›×œ×•×œ:\nâ€¢ ×™×¦×™×¨×ª ×¤×¨×•××¤×˜×™× ×œ-Cursor (6 ×§×‘×¦×™×)\nâ€¢ ×™×¦×™×¨×ª ×ª×™×¢×•×“ ××¢×•×“×›×Ÿ (5 ×§×‘×¦×™×)\nâ€¢ ×™×¦×™×¨×ª ×’×™×‘×•×™ ZIP ×©×œ ×›×œ ×”×¤×¨×•×™×§×˜\nâ€¢ ×©××™×¨×” ×‘-GitHub\n\n×”×’×™×‘×•×™ ×™×™×©××¨ ×‘×ª×™×§×™×™×ª ×”×”×•×¨×“×•×ª.')) {
                // ×”×‘×œ×•×§ ×™×•×¦×’ ×¢"×™ ×”×©×¨×ª â€“ ×œ× ××•×¡×™×¤×™× ×œ×•×’×™× ×™×“× ×™×™×
                
                const requestData = {};
                if (versionDescription) {
                    requestData.version_description = versionDescription;
                    // ×œ× ××•×¡×™×¤×™× ×œ×•×’ ×¦×“-×œ×§×•×— â€“ ×”×”×•×“×¢×” ×ª×•×¦×’ ×‘×ª×•×š ×”×‘×œ×•×§ ×¢"×™ ×”×©×¨×ª
                }
                
                // ×©×œ×™×—×” ×‘×§×©×” ×œ×©×¨×ª ×œ×™×¦×•×¨ ×’×™×‘×•×™
                fetch('/api/create-backup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('×”×©×¨×ª ×œ× ×–××™×Ÿ');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        const backupSection = document.getElementById('backup-section');
                        backupSection.style.display = 'none';
                        document.getElementById('version-description').value = '';
                    }
                })
                .catch(error => {
                    addLogEntry('âŒ ×©×’×™××ª ×¨×©×ª ×‘×™×¦×™×¨×ª ×’×™×‘×•×™: ' + error.message);
                });
            }
        }

        function checkServerRestart() {
            fetch('/api/server-id')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('×”×©×¨×ª ×œ× ×–××™×Ÿ');
                    }
                    return response.json();
                })
                .then(data => {
                    if (currentServerId === null) {
                        // ×”×¤×¢×œ×” ×¨××©×•× ×”
                        currentServerId = data.server_id;
                        // ourLog('××–×”×” ×©×¨×ª ×¨××©×•× ×™: ' + currentServerId);
                        showStatus('××—×•×‘×¨ ×œ×©×¨×ª - ×¨×¢× ×•×Ÿ ××•×˜×•××˜×™ ×¤×¢×™×œ', 'success');
                    } else if (currentServerId !== data.server_id) {
                        // ×”×©×¨×ª ×”×ª×—×™×œ ××—×“×©
                        // ourLog('×”×©×¨×ª ×”×ª×—×™×œ ××—×“×©! ××–×”×” ×—×“×©: ' + data.server_id);
                        currentServerId = data.server_id;

                        // ×”×•×¡×¤×ª ×”×•×“×¢×” ×©×”×©×¨×ª ×”×ª×—×™×œ ××—×“×© (×‘×œ×™ ×œ××—×•×§ ××ª ×”×”×™×¡×˜×•×¨×™×”)
                        addLogEntry('ğŸ”„ ×”×©×¨×ª ×”×ª×—×™×œ ××—×“×© - ×××©×™×š ×¢× ×”×”×™×¡×˜×•×¨×™×” ×”×§×™×™××ª');
                        addLogEntry('=' * 80);
                        showStatus('×”×©×¨×ª ×”×ª×—×™×œ ××—×“×© - ×”×”×™×¡×˜×•×¨×™×” × ×©××¨×”', 'success');

                        // ×˜×¢×™× ×” ××—×“×© ×©×œ ×”×œ×•×’×™×
                        refreshLogs();
                    }
                })
                .catch(error => {
                    // ourLog('×©×’×™××” ×‘×‘×“×™×§×ª ××–×”×” ×”×©×¨×ª: ' + error.message);
                    showStatus('×”×©×¨×ª ×œ× ×–××™×Ÿ - ×××ª×™×Ÿ ×œ×—×™×‘×•×¨...', 'error');
                });
        }

        // ×¨×¢× ×•×Ÿ ××•×˜×•××˜×™ ×›×œ 2 ×©× ×™×•×ª
        function startAutoRefresh() {
            // ourLog('â° ××ª×—×™×œ ×¨×¢× ×•×Ÿ ××•×˜×•××˜×™ ×›×œ 2 ×©× ×™×•×ª');

            // ×¢×¦×™×¨×ª ×¨×¢× ×•×Ÿ ×§×•×“× ×× ×§×™×™×
            if (refreshInterval) {
                clearInterval(refreshInterval);
                // ourLog('ğŸ›‘ ×¢×¦×¨×ª×™ ×¨×¢× ×•×Ÿ ×§×•×“×');
            }

            refreshInterval = setInterval(() => {
                // The simplest and most reliable way: just call the main refresh function.
                refreshLogs();
            }, 5000); // ×¨×¢× ×•×Ÿ ×›×œ 5 ×©× ×™×•×ª

            // ×”×’×“×¨×ª ×”× ×•×¨×” ×›××—×•×‘×¨×ª ×¨×§ ×× ×”×™× ×œ× ×›×‘×¨ ××—×•×‘×¨×ª
            const statusLed = document.getElementById('statusLed');
            if (statusLed && !statusLed.className.includes('connected')) {
                showStatus('××—×•×‘×¨ ×œ×©×¨×ª', 'connected');
            }
        }

        function stopAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            showStatus('×× ×•×ª×§ ××”×©×¨×ª', 'disconnected');
        }

        // ×”×ª×—×œ×” ××™×™×“×™×ª
        window.onload = function() {
            loadDarkModePreference();
            
            // ×”×•×¡×¤×ª ×”×•×“×¢×” ×‘×¨×•×¨×” ×©×”×§×•× ×¡×•×œ × ×˜×¢×Ÿ
            addLogEntry('ğŸ–¥ï¸ ×§×•× ×¡×•×œ HTML × ×˜×¢×Ÿ - ××ª×—×™×œ ×¨×¢× ×•×Ÿ ××•×˜×•××˜×™...');
            addLogEntry('=' * 60);

            // ×‘×“×™×§×” ×¨××©×•× ×™×ª ×× ×”×©×¨×ª ×–××™×Ÿ
            checkServerRestart();

            // ×˜×¢×™× ×” ×¨××©×•× ×™×ª ×©×œ ×›×œ ×”×œ×•×’×™×
            refreshLogs();

            // ×”×ª×—×œ×ª ×”×¨×¢× ×•×Ÿ ×”××•×˜×•××˜×™
            startAutoRefresh();

            // ×”×•×“×¢×” ×‘×§×•× ×¡×•×œ ×©×”×¨×¢× ×•×Ÿ ×”××•×˜×•××˜×™ ×”×ª×—×™×œ
            setTimeout(() => {
                addLogEntry('[××¢×¨×›×ª] ×¨×¢× ×•×Ÿ ××•×˜×•××˜×™ ×¤×¢×™×œ - ×”×§×•× ×¡×•×œ ×™×ª×¢×“×›×Ÿ ×›×œ 2 ×©× ×™×•×ª');
                addLogEntry('[××¢×¨×›×ª] ×”×¨×¢× ×•×Ÿ ×”××•×˜×•××˜×™ ××•×¡×™×£ ×œ×•×’×™× ×—×“×©×™× ×œ×œ× × ×™×§×•×™ ×”×§×•× ×¡×•×œ');
            }, 1000);
        };

        // Fallback: ensure logs are rendered even if previous logic fails
        if (!window.addLogEntry || typeof window.addLogEntry !== 'function') {
            window.addLogEntry = function(logText) {
                try {
                    const container = document.getElementById('console-output');
                    if (!container) return;
                    const div = document.createElement('div');
                    div.className = 'log-entry INFO';
                    div.textContent = String(logText || '');
                    container.appendChild(div);
                } catch (e) {
                    console && console.error('addLogEntry fallback error:', e);
                }
            };
        }

        // × ×™×¡×™×•×Ÿ ×œ× ×˜×¨×œ ×”×•×“×¢×•×ª ×©×’×™××” ××”×¨×—×‘×•×ª
        if (window.chrome && window.chrome.runtime) {
            // × ×™×¡×™×•×Ÿ ×œ× ×˜×¨×œ ×”×•×“×¢×•×ª ××”×¨×—×‘×•×ª
            try {
                window.chrome.runtime.onMessage = null;
                window.chrome.runtime.onConnect = null;
                window.chrome.runtime.onMessage.addListener = null;
                window.chrome.runtime.onConnect.addListener = null;
                
                // × ×™×¡×™×•×Ÿ × ×•×¡×£ ×œ× ×˜×¨×œ ×”×•×“×¢×•×ª ××”×¨×—×‘×•×ª
                if (window.chrome.runtime.onMessage) {
                    window.chrome.runtime.onMessage = function() { return; };
                }
                if (window.chrome.runtime.onConnect) {
                    window.chrome.runtime.onConnect = function() { return; };
                }
                
            } catch (e) {
                // ×œ× × ×™×ª×Ÿ ×œ× ×˜×¨×œ
            }
        }

        // × ×™×¡×™×•×Ÿ ×œ× ×˜×¨×œ ××ª ×”×§×•× ×¡×•×œ ×©×œ ×”×“×¤×“×¤×Ÿ
        try {
            // × ×™×§×•×™ ×”×§×•× ×¡×•×œ
            console.clear();
            
            // ×›×™×‘×•×™ ××•×—×œ×˜ ×©×œ ×›×œ ×”×œ×•×’×™×
            const originalConsole = console;
            Object.keys(console).forEach(key => {
                if (typeof console[key] === 'function') {
                    console[key] = function() { return; };
                }
            });
            
            // ×›×™×‘×•×™ ××•×—×œ×˜ ×©×œ ×›×œ ×”×œ×•×’×™×
            console.error = function() { return; };
            console.warn = function() { return; };
            console.log = function() { return; };
            console.info = function() { return; };
            console.debug = function() { return; };
            console.trace = function() { return; };
            console.table = function() { return; };
            console.group = function() { return; };
            console.groupEnd = function() { return; };
            console.time = function() { return; };
            console.timeEnd = function() { return; };
            
            // ×”×—×–×¨×ª ×¨×§ ×”×œ×•×’×™× ×©×œ× ×•
            function ourLog(message) {
                originalConsole.log(message);
            }
            window.ourLog = ourLog;
            
        // × ×™×¡×™×•×Ÿ × ×•×¡×£ ×œ× ×˜×¨×œ ×”×•×“×¢×•×ª ×©×’×™××” - ×”×•×¡×¨ ×›×“×™ ×œ×× ×•×¢ ×ª×§×™×¢×•×ª
        // ×”×§×•×“ ×”××™×•×ª×¨ ×©×’×•×¨× ×œ×¢×•××¡ ×”×•×¡×¨
            
        } catch (e) {
            // ×œ× × ×™×ª×Ÿ ×œ× ×˜×¨×œ
        }

        // × ×™×¡×™×•×Ÿ ×œ× ×˜×¨×œ ×”×•×“×¢×•×ª ×©×’×™××” ×‘×¨××ª ×”×“×¤×“×¤×Ÿ - ×”×•×¡×¨ ×›×“×™ ×œ×× ×•×¢ ×ª×§×™×¢×•×ª

        // ×¤×•× ×§×¦×™×” ×œ×”×—×œ×¤×ª ×¢×¨×›×” ×›×”×”/×‘×”×™×¨×”
        function toggleDarkMode() {
            const body = document.body;
            const toggleButton = document.querySelector('.dark-mode-toggle');
            
            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                toggleButton.textContent = 'ğŸŒ™';
                toggleButton.title = '×”×—×œ×£ ×œ×¢×¨×›×” ×›×”×”';
                localStorage.setItem('darkMode', 'false');
            } else {
                body.classList.add('dark-mode');
                toggleButton.textContent = 'â˜€ï¸';
                toggleButton.title = '×”×—×œ×£ ×œ×¢×¨×›×” ×‘×”×™×¨×”';
                localStorage.setItem('darkMode', 'true');
            }
        }

        // ×˜×¢×™× ×ª ×”×¢×“×¤×ª ×¢×¨×›×” ×›×”×” ××”×–×™×›×¨×•×Ÿ ×”××§×•××™
        function loadDarkModePreference() {
            const darkMode = localStorage.getItem('darkMode');
            if (darkMode === 'true') {
                document.body.classList.add('dark-mode');
                const toggleButton = document.querySelector('.dark-mode-toggle');
                toggleButton.textContent = 'â˜€ï¸';
                toggleButton.title = '×”×—×œ×£ ×œ×¢×¨×›×” ×‘×”×™×¨×”';
            }
        }

        // ×¢×¦×™×¨×ª ×”×¨×¢× ×•×Ÿ ×”××•×˜×•××˜×™ ×›×©×¢×•×–×‘×™× ××ª ×”×“×£
        window.addEventListener('beforeunload', function() {
            stopAutoRefresh();
        });
    </script>
</body>
</html>
