<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ניהול למידה חכמה - Outlook Email Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .navigation {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .nav-btn.active {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .nav-btn.active:hover {
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        /* סגנונות ערכה כהה לניווט */
        body.dark-mode .navigation {
            background: #3d3d3d;
        }

        body.dark-mode .nav-btn {
            background: linear-gradient(135deg, #4d4d4d 0%, #5d5d5d 100%);
        }

        body.dark-mode .nav-btn:hover {
            background: linear-gradient(135deg, #5d5d5d 0%, #6d6d6d 100%);
        }

        body.dark-mode .nav-btn.active {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        /* Dark Mode Toggle Button */
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
        
        .dark-mode-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card.clickable {
            cursor: pointer;
            border: 2px solid transparent;
        }

        .stat-card.clickable:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            border-color: #4CAF50;
        }

        .stat-card.clickable:active {
            transform: translateY(-2px);
        }

        .stat-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5em;
            opacity: 0.8;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 1.1rem;
        }
        
        .learning-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .section h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .pattern-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-right: 4px solid #667eea;
        }
        
        .pattern-key {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .pattern-value {
            color: #666;
            font-size: 0.9rem;
        }
        
        .pattern-weight {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .pattern-frequency {
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-left: 5px;
        }
        
        .controls {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .control-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, #f093fb, #f5576c);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
        }
        
        .status {
            padding: 10px 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .empty-state h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .user-preferences {
            display: grid;
            gap: 25px;
        }
        
        .preference-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        
        .preference-group h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .preference-group p {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .category-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .category-checkboxes label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 8px;
            border-radius: 5px;
            transition: background 0.3s ease;
        }
        
        .category-checkboxes label:hover {
            background: #e9ecef;
        }
        
        .category-checkboxes input[type="checkbox"] {
            margin-left: 8px;
            transform: scale(1.2);
        }
        
        .sender-input, .keyword-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .sender-input input, .keyword-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .sender-input input:focus, .keyword-input input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.25);
        }
        
        .sender-input button, .keyword-input button {
            padding: 10px 20px;
            font-size: 14px;
        }
        
        .sender-item, .keyword-item {
            background: white;
            padding: 10px 15px;
            border-radius: 20px;
            margin: 5px;
            display: inline-block;
            border: 1px solid #e9ecef;
            position: relative;
        }
        
        .sender-item .remove-btn, .keyword-item .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            margin-right: 8px;
            position: absolute;
            right: -5px;
            top: -5px;
        }
        
        .sender-item .remove-btn:hover, .keyword-item .remove-btn:hover {
            background: #c82333;
        }
        
        @media (max-width: 768px) {
            .learning-sections {
                grid-template-columns: 1fr;
            }
            
            .control-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .category-checkboxes {
                grid-template-columns: 1fr;
            }
            
            .sender-input, .keyword-input {
                flex-direction: column;
            }
        }
        
        /* Dark Mode Styles */
        body.dark-mode {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: #e2e8f0;
        }
        
        body.dark-mode .stat-card {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .stat-card:hover {
            background: #5a6578;
        }
        
        body.dark-mode .action-btn {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .action-btn:hover {
            background: #5a6578;
        }
        
        body.dark-mode .settings-section {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .settings-section:hover {
            background: #5a6578;
        }
        
        body.dark-mode .category-item {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .sender-tag {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .keyword-tag {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .input-field {
            background: #4a5568;
            color: #e2e8f0;
            border-color: #718096;
        }
        
        body.dark-mode .input-field:focus {
            border-color: #667eea;
        }
        
        body.dark-mode .add-btn {
            background: #667eea;
            color: white;
        }
        
        body.dark-mode .add-btn:hover {
            background: #5a67d8;
        }
        
        body.dark-mode .section {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .section:hover {
            background: #5a6578;
        }
        
        body.dark-mode .section-title {
            color: #e2e8f0;
        }
        
        body.dark-mode .section-description {
            color: #cbd5e0;
        }
        
        body.dark-mode .pattern-item {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .pattern-item:hover {
            background: #5a6578;
        }
        
        body.dark-mode .pattern-title {
            color: #e2e8f0;
        }
        
        body.dark-mode .pattern-description {
            color: #cbd5e0;
        }
        
        body.dark-mode .pattern-stats {
            color: #a0aec0;
        }
        
        /* סגנונות נוספים לערכה הכהה */
        body.dark-mode .category-checkboxes {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .sender-input {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .keyword-input {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .checkbox-label {
            color: #e2e8f0;
        }
        
        body.dark-mode .checkbox-label:hover {
            color: #f7fafc;
        }
        
        body.dark-mode .remove-btn {
            background: #e53e3e;
            color: white;
        }
        
        body.dark-mode .remove-btn:hover {
            background: #c53030;
        }
        
        body.dark-mode .tag-list {
            background: #4a5568;
        }
        
        body.dark-mode .tag-item {
            background: #5a6578;
            color: #e2e8f0;
        }
        
        body.dark-mode .tag-item:hover {
            background: #6b7280;
        }
        
        body.dark-mode .pattern-list {
            background: #4a5568;
        }
        
        body.dark-mode .pattern-list-item {
            background: #5a6578;
            color: #e2e8f0;
        }
        
        body.dark-mode .pattern-list-item:hover {
            background: #6b7280;
        }
        
        body.dark-mode .stats-grid {
            background: #4a5568;
        }
        
        body.dark-mode .stats-item {
            background: #5a6578;
            color: #e2e8f0;
        }
        
        body.dark-mode .stats-item:hover {
            background: #6b7280;
        }
        
        body.dark-mode .stats-label {
            color: #e2e8f0;
        }
        
        body.dark-mode .stats-value {
            color: #f7fafc;
        }
        
        /* סגנונות ספציפיים לאלמנטים עם רקע לבן */
        body.dark-mode .stat-card {
            background: #4a5568 !important;
            color: #e2e8f0 !important;
        }
        
        body.dark-mode .stat-card:hover {
            background: #5a6578 !important;
        }

        body.dark-mode .stat-card.clickable:hover {
            background: #5a6578 !important;
            border-color: #68d391 !important;
        }

        /* סגנונות למודל */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 2em;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .modal-body {
            padding: 30px;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* סגנונות לגרפים */
        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        .chart-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* סגנונות ערכה כהה למודל */
        body.dark-mode .modal-content {
            background: #2d3748;
            color: #f7fafc;
        }

        body.dark-mode .chart-container {
            background: #4a5568;
            border-color: #718096;
        }

        body.dark-mode .chart-title {
            color: #f7fafc;
        }

        /* תיקון קריאות בערכה כהה */
        body.dark-mode .modal-body div[style*="background: #d1ecf1"] {
            background: #1a365d !important;
            color: #e2e8f0 !important;
            border-left-color: #3182ce !important;
        }

        body.dark-mode .modal-body div[style*="background: #fff3cd"] {
            background: #744210 !important;
            color: #fef5e7 !important;
            border-left-color: #d69e2e !important;
        }

        body.dark-mode .modal-body div[style*="background: #d4edda"] {
            background: #1e4d2b !important;
            color: #d1f2eb !important;
            border-left-color: #38a169 !important;
        }

        /* תיקון נוסף לכל הריבועים הצבעוניים */
        body.dark-mode .modal-body div[style*="background: #e3f2fd"] {
            background: #1e3a8a !important;
            color: #dbeafe !important;
        }

        body.dark-mode .modal-body div[style*="background: #f3e5f5"] {
            background: #581c87 !important;
            color: #f3e8ff !important;
        }

        body.dark-mode .modal-body div[style*="background: #e8f5e8"] {
            background: #14532d !important;
            color: #dcfce7 !important;
        }

        /* תיקון לטקסט בתוך הריבועים */
        body.dark-mode .modal-body div[style*="color: #666"] {
            color: #a0aec0 !important;
        }

        body.dark-mode .modal-body div[style*="color: #1976d2"] {
            color: #60a5fa !important;
        }

        body.dark-mode .modal-body div[style*="color: #7b1fa2"] {
            color: #c084fc !important;
        }

        body.dark-mode .modal-body div[style*="color: #2e7d32"] {
            color: #4ade80 !important;
        }

        /* תיקון נוסף למודל דיוק ניבוי */
        body.dark-mode .modal-body div[style*="font-size: 4em"] {
            color: #f7fafc !important;
        }

        body.dark-mode .modal-body div[style*="font-size: 1.2em"] {
            color: #a0aec0 !important;
        }

        body.dark-mode .modal-body div[style*="font-size: 1.1em"] {
            color: #f7fafc !important;
        }

        /* תיקון לטקסט בתוך רשימות */
        body.dark-mode .modal-body ul li {
            color: #e2e8f0 !important;
        }

        body.dark-mode .modal-body ul {
            color: #e2e8f0 !important;
        }
        
        body.dark-mode .stat-number {
            color: #f7fafc !important;
        }
        
        body.dark-mode .stat-label {
            color: #cbd5e0 !important;
        }
        
        body.dark-mode .learning-sections {
            background: transparent;
        }
        
        body.dark-mode .action-buttons {
            background: transparent;
        }
        
        body.dark-mode .action-buttons .btn {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .action-buttons .btn:hover {
            background: #5a6578;
        }
        
        body.dark-mode .action-buttons .btn.delete {
            background: #e53e3e;
            color: white;
        }
        
        body.dark-mode .action-buttons .btn.delete:hover {
            background: #c53030;
        }
        
        body.dark-mode .action-buttons .btn.reset {
            background: #ed8936;
            color: white;
        }
        
        body.dark-mode .action-buttons .btn.reset:hover {
            background: #dd6b20;
        }
        
        body.dark-mode .action-buttons .btn.refresh {
            background: #38a169;
            color: white;
        }
        
        body.dark-mode .action-buttons .btn.refresh:hover {
            background: #2f855a;
        }
        
        body.dark-mode .action-buttons .btn.export {
            background: #3182ce;
            color: white;
        }
        
        body.dark-mode .action-buttons .btn.export:hover {
            background: #2c5282;
        }
        
        /* סגנונות לערכה הכהה - הגדרות משתמש */
        body.dark-mode .user-preferences {
            background: #4a5568;
            color: #e2e8f0;
        }
        
        body.dark-mode .preference-group {
            background: #5a6578;
            color: #e2e8f0;
        }
        
        body.dark-mode .preference-group h4 {
            color: #f7fafc;
        }
        
        body.dark-mode .preference-group p {
            color: #cbd5e0;
        }
        
        body.dark-mode .preference-group label {
            color: #e2e8f0;
        }
        
        body.dark-mode .preference-group label:hover {
            color: #f7fafc;
        }
        
        body.dark-mode .preference-group input[type="checkbox"] {
            accent-color: #667eea;
        }
        
        body.dark-mode .preference-group input[type="text"] {
            background: #4a5568;
            color: #e2e8f0;
            border-color: #718096;
        }
        
        body.dark-mode .preference-group input[type="text"]:focus {
            border-color: #667eea;
            background: #5a6578;
        }
        
        body.dark-mode .preference-group input[type="text"]::placeholder {
            color: #a0aec0;
        }
        
        /* תיקון אלמנטים עם רקע לבן שלא קיבלו סגנונות */
        body.dark-mode .controls {
            background: #4a5568 !important;
            color: #e2e8f0 !important;
        }
        
        body.dark-mode .sender-item, 
        body.dark-mode .keyword-item {
            background: #5a6578 !important;
            color: #e2e8f0 !important;
        }
        
        body.dark-mode .sender-item:hover, 
        body.dark-mode .keyword-item:hover {
            background: #6b7280 !important;
        }
        
        body.dark-mode .sender-item .remove-btn, 
        body.dark-mode .keyword-item .remove-btn {
            background: #e53e3e !important;
            color: white !important;
        }
        
        body.dark-mode .sender-item .remove-btn:hover, 
        body.dark-mode .keyword-item .remove-btn:hover {
            background: #c53030 !important;
        }
        
        /* תיקון כותרות כהה בדפוסים */
        body.dark-mode .pattern-section h3 {
            color: #f7fafc !important;
        }
        
        body.dark-mode .pattern-section h4 {
            color: #f7fafc !important;
        }
        
        body.dark-mode .pattern-item h4 {
            color: #f7fafc !important;
        }
        
        body.dark-mode .pattern-item .pattern-name {
            color: #f7fafc !important;
        }
        
        body.dark-mode .pattern-item .pattern-description {
            color: #cbd5e0 !important;
        }
        
        body.dark-mode .pattern-item .pattern-weight {
            color: #cbd5e0 !important;
        }
        
        body.dark-mode .pattern-item .pattern-category {
            color: #cbd5e0 !important;
        }
        
        /* תיקון כפתורים בדפוסים */
        body.dark-mode .pattern-item .count-badge {
            background: #38a169 !important;
            color: white !important;
        }
        
        body.dark-mode .pattern-item .percentage-badge {
            background: #667eea !important;
            color: white !important;
        }
        
        /* תיקון כותרת סטטיסטיקות מפורטות */
        body.dark-mode .stats-section h3 {
            color: #f7fafc !important;
        }
        
        body.dark-mode .stats-section h4 {
            color: #f7fafc !important;
        }
        
        body.dark-mode .stats-item .stats-label {
            color: #f7fafc !important;
        }
        
        body.dark-mode .stats-item .stats-value {
            color: #f7fafc !important;
        }
        
        /* תיקון progress bars */
        body.dark-mode .progress-bar {
            background: #4a5568 !important;
        }
        
        body.dark-mode .progress-fill {
            background: #667eea !important;
        }
        
        /* תיקון כל הכפתורים */
        body.dark-mode .btn {
            background: #4a5568 !important;
            color: #e2e8f0 !important;
            border-color: #718096 !important;
        }
        
        body.dark-mode .btn:hover {
            background: #5a6578 !important;
            color: #f7fafc !important;
        }
        
        body.dark-mode .btn-success {
            background: #38a169 !important;
            color: white !important;
        }
        
        body.dark-mode .btn-success:hover {
            background: #2f855a !important;
        }
        
        body.dark-mode .btn-warning {
            background: #ed8936 !important;
            color: white !important;
        }
        
        body.dark-mode .btn-warning:hover {
            background: #dd6b20 !important;
        }
        
        body.dark-mode .btn-danger {
            background: #e53e3e !important;
            color: white !important;
        }
        
        body.dark-mode .btn-danger:hover {
            background: #c53030 !important;
        }
        
        body.dark-mode .remove-btn {
            background: #e53e3e !important;
            color: white !important;
        }
        
        body.dark-mode .remove-btn:hover {
            background: #c53030 !important;
        }
        
        /* תיקון ספציפי לדפוסי חשיבות וקטגוריות */
        body.dark-mode .pattern-key {
            color: #f7fafc !important;
            font-weight: bold !important;
        }
        
        body.dark-mode .pattern-value {
            color: #cbd5e0 !important;
        }
        
        body.dark-mode .pattern-weight {
            color: #f7fafc !important;
            font-weight: bold !important;
        }
        
        body.dark-mode .pattern-frequency {
            color: #f7fafc !important;
            font-weight: bold !important;
        }
        
        body.dark-mode .empty-state h4 {
            color: #f7fafc !important;
        }
        
        body.dark-mode .empty-state p {
            color: #cbd5e0 !important;
        }
        
        /* תיקון ספציפי לכותרות הדפוסים */
        body.dark-mode .section h3 {
            color: #f7fafc !important;
        }
        
        /* תיקון ספציפי לפריטי דפוסים */
        body.dark-mode .pattern-item {
            background: #5a6578 !important;
            color: #e2e8f0 !important;
            border: 1px solid #718096 !important;
        }
        
        body.dark-mode .pattern-item:hover {
            background: #6b7280 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="החלף בין ערכה בהירה לכהה">🌙</button>
        
        <div class="navigation">
            <a href="/" class="nav-btn" title="ניהול מיילים - הצגת וניהול כל המיילים עם ניתוח AI וחישוב ציוני חשיבות">
                📧 ניהול מיילים
            </a>
            <a href="/meetings" class="nav-btn" title="ניהול פגישות - הצגת וניהול כל הפגישות עם ניתוח AI וחישוב ציוני חשיבות">
                📅 ניהול פגישות
            </a>
            <a href="/consol" class="nav-btn" title="קונסול - הצגת כל הלוגים וההודעות מהשרת בזמן אמת">
                🖥️ קונסול
            </a>
            <a href="/learning-management" class="nav-btn active" title="ניהול למידה - הצגת סטטיסטיקות למידה, דפוסי חשיבות והגדרות משתמש">
                🧠 ניהול למידה
            </a>
        </div>
        
        <div class="header">
            <h1>🧠 ניהול למידה חכמה</h1>
            <p>ניהול והגדרת מערכת הלמידה האישית</p>
        </div>
        
        <div class="stats-overview" id="stats-overview">
            <div class="stat-card clickable" onclick="showDetailedStats('feedback')" title="לחץ לפרטים נוספים - סה״כ משובים - מספר הפעמים שנתת משוב על מיילים ופגישות (משפיע על דיוק המערכת)">
                <div class="stat-number" id="total-feedback">-</div>
                <div class="stat-label">סה"כ משובים</div>
                <div class="stat-icon">📊</div>
            </div>
            <div class="stat-card clickable" onclick="showDetailedStats('patterns')" title="לחץ לפרטים נוספים - דפוסי למידה - מספר הדפוסים שהמערכת למדה מההתנהגות שלך (מילות מפתח, שולחים, זמנים)">
                <div class="stat-number" id="total-patterns">-</div>
                <div class="stat-label">דפוסי למידה</div>
                <div class="stat-icon">🧠</div>
            </div>
            <div class="stat-card clickable" onclick="showDetailedStats('learning')" title="לחץ לפרטים נוספים - רמת למידה - עד כמה המערכת מכירה את העדפותיך (מבוסס על כמות המשובים והדפוסים)">
                <div class="stat-number" id="learning-progress">-</div>
                <div class="stat-label">רמת למידה</div>
                <div class="stat-icon">📈</div>
            </div>
            <div class="stat-card clickable" onclick="showDetailedStats('accuracy')" title="לחץ לפרטים נוספים - דיוק ניבוי - עד כמה המערכת מנבאת נכון את החשיבות (השוואה בין ציוני המשתמש ל-AI)">
                <div class="stat-number" id="accuracy-rate">-</div>
                <div class="stat-label">דיוק ניבוי</div>
                <div class="stat-icon">🎯</div>
            </div>
        </div>
        
        <!-- אזור תצוגת פרטים מפורטים -->
        <div id="detailed-stats-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-title">פרטים מפורטים</h2>
                    <button class="close-btn" onclick="closeDetailedStats()">&times;</button>
                </div>
                <div class="modal-body" id="modal-body">
                    <!-- תוכן דינמי יוכנס כאן -->
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <button class="btn" onclick="refreshData()" title="רענן נתונים - טען מחדש את כל הסטטיסטיקות והנתונים מהשרת">🔄 רענן נתונים</button>
                <button class="btn btn-success" onclick="exportProfile()" title="ייצא פרופיל - שמור את כל נתוני הלמידה והדפוסים לקובץ JSON">💾 ייצא פרופיל</button>
                <button class="btn btn-warning" onclick="resetLearning()" title="אפס למידה - מחק את כל הדפוסים והמשובים אבל שמור את ההגדרות">🔄 אפס למידה</button>
                <button class="btn btn-danger" onclick="clearAllData()" title="מחק הכל - מחק את כל הנתונים כולל הגדרות (פעולה בלתי הפיכה!)">🗑️ מחק הכל</button>
            </div>
            <div id="status"></div>
        </div>
        
        <div class="section">
            <h3>⚙️ הגדרות משתמש</h3>
            <div class="user-preferences">
                <div class="preference-group">
                    <h4>קטגוריות חשובות</h4>
                    <p>בחר איזה קטגוריות חשובות לך (המערכת תיתן להן עדיפות גבוהה יותר):</p>
                    <div class="category-checkboxes">
                        <label><input type="checkbox" id="pref-work" value="work"> עבודה</label>
                        <label><input type="checkbox" id="pref-personal" value="personal"> אישי</label>
                        <label><input type="checkbox" id="pref-urgent" value="urgent"> דחוף</label>
                        <label><input type="checkbox" id="pref-meeting" value="meeting"> פגישה</label>
                        <label><input type="checkbox" id="pref-marketing" value="marketing"> שיווק</label>
                        <label><input type="checkbox" id="pref-system" value="system"> מערכת</label>
                    </div>
                </div>
                
                <div class="preference-group">
                    <h4>שולחים חשובים</h4>
                    <p>הוסף שולחים חשובים (המערכת תיתן למיילים מהם עדיפות גבוהה):</p>
                    <div class="sender-input">
                        <input type="text" id="sender-input" placeholder="הכנס כתובת אימייל או שם שולח">
                        <button class="btn" onclick="addImportantSender()">הוסף</button>
                    </div>
                    <div id="important-senders-list"></div>
                </div>
                
                <div class="preference-group">
                    <h4>מילות מפתח חשובות</h4>
                    <p>הוסף מילות מפתח חשובות (המערכת תחפש אותן במיילים):</p>
                    <div class="keyword-input">
                        <input type="text" id="keyword-input" placeholder="הכנס מילת מפתח">
                        <button class="btn" onclick="addImportantKeyword()">הוסף</button>
                    </div>
                    <div id="important-keywords-list"></div>
                </div>
                
                <div class="preference-group">
                    <button class="btn btn-success" onclick="saveUserPreferences()">💾 שמור הגדרות</button>
                </div>
            </div>
        </div>
        
        <div class="learning-sections">
            <div class="section">
                <h3>📊 דפוסי חשיבות</h3>
                <div id="importance-patterns">
                    <div class="loading">
                        <div class="spinner"></div>
                        טוען דפוסי חשיבות...
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3>🏷️ דפוסי קטגוריות</h3>
                <div id="category-patterns">
                    <div class="loading">
                        <div class="spinner"></div>
                        טוען דפוסי קטגוריות...
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h3>📈 סטטיסטיקות מפורטות</h3>
            <div id="detailed-stats">
                <div class="loading">
                    <div class="spinner"></div>
                    טוען סטטיסטיקות...
                </div>
            </div>
        </div>
    </div>

    <script>
        let learningData = {};
        let userPreferences = {
            importantCategories: [],
            importantSenders: [],
            importantKeywords: []
        };
        
        // טעינה ראשונית
        document.addEventListener('DOMContentLoaded', function() {
            loadDarkMode();
            loadLearningData();
            loadUserPreferences();
        });
        
        function goBack() {
            window.location.href = '/';
        }
        
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDark);
            
            // עדכון אייקון הכפתור
            const toggleBtn = document.querySelector('.dark-mode-toggle');
            toggleBtn.textContent = isDark ? '☀️' : '🌙';
        }
        
        // טעינת מצב ערכה כהה
        function loadDarkMode() {
            const isDark = localStorage.getItem('darkMode') === 'true';
            if (isDark) {
                document.body.classList.add('dark-mode');
                const toggleBtn = document.querySelector('.dark-mode-toggle');
                toggleBtn.textContent = '☀️';
            }
        }
        
        async function loadLearningData() {
            try {
                showStatus('טוען נתוני למידה...', 'info');
                
                // טעינת סטטיסטיקות
                const statsResponse = await fetch('/api/learning-stats');
                const stats = await statsResponse.json();
                
                // טעינת פרופיל משתמש
                const profileResponse = await fetch('/api/user-profile');
                const profile = await profileResponse.json();
                
                learningData = { stats, profile };
                displayLearningData();
                showStatus('נתוני למידה נטענו בהצלחה!', 'success');
                
            } catch (error) {
                showStatus('שגיאה בטעינת נתוני למידה: ' + error.message, 'error');
            }
        }
        
        function displayLearningData() {
            // הצגת סטטיסטיקות כללית
            document.getElementById('total-feedback').textContent = learningData.stats.total_feedback || 0;
            document.getElementById('total-patterns').textContent = learningData.stats.total_patterns || 0;
            
            // חישוב רמת למידה
            const learningLevel = calculateLearningLevel(learningData.stats);
            document.getElementById('learning-progress').textContent = learningLevel + '%';
            
            // חישוב דיוק ניבוי
            const accuracy = calculateAccuracy(learningData.stats);
            document.getElementById('accuracy-rate').textContent = accuracy + '%';
            
            // הצגת דפוסי חשיבות
            displayImportancePatterns();
            
            // הצגת דפוסי קטגוריות
            displayCategoryPatterns();
            
            // הצגת סטטיסטיקות מפורטות
            displayDetailedStats();
        }
        
        function calculateLearningLevel(stats) {
            // שימוש בנתונים החדשים מהשרת
            return stats.learning_level || 0;
        }
        
        function calculateAccuracy(stats) {
            // שימוש בנתונים החדשים מהשרת
            return Math.round((stats.accuracy_rate || 0) * 100);
        }
        
        function displayImportancePatterns() {
            const container = document.getElementById('importance-patterns');
            const patterns = learningData.profile.patterns || {};
            
            // איסוף כל דפוסי החשיבות
            const allPatterns = [];
            
            // דפוסי מילות מפתח
            const keywordPatterns = patterns.keyword_importance || {};
            Object.entries(keywordPatterns).forEach(([key, data]) => {
                allPatterns.push({
                    key: key,
                    type: 'מילת מפתח',
                    weight: data.weight,
                    frequency: data.frequency,
                    lastUsed: data.last_used
                });
            });
            
            // דפוסי שולחים
            const senderPatterns = patterns.sender_importance || {};
            Object.entries(senderPatterns).forEach(([key, data]) => {
                allPatterns.push({
                    key: key,
                    type: 'שולח',
                    weight: data.weight,
                    frequency: data.frequency,
                    lastUsed: data.last_used
                });
            });
            
            // דפוסי דומיין
            const domainPatterns = patterns.domain_importance || {};
            Object.entries(domainPatterns).forEach(([key, data]) => {
                allPatterns.push({
                    key: key,
                    type: 'דומיין',
                    weight: data.weight,
                    frequency: data.frequency,
                    lastUsed: data.last_used
                });
            });
            
            // דפוסי זמן
            const timePatterns = patterns.time_importance || {};
            Object.entries(timePatterns).forEach(([key, data]) => {
                const timeLabel = key.startsWith('hour_') ? `שעה ${key.split('_')[1]}` : 
                                key.startsWith('day_') ? `יום ${key.split('_')[1]}` : key;
                allPatterns.push({
                    key: timeLabel,
                    type: 'זמן',
                    weight: data.weight,
                    frequency: data.frequency,
                    lastUsed: data.last_used
                });
            });
            
            if (allPatterns.length === 0) {
                container.innerHTML = '<div class="empty-state"><h4>אין דפוסי חשיבות</h4><p>תן משוב על מיילים כדי לבנות דפוסי למידה</p></div>';
                return;
            }
            
            // מיון לפי משקל
            const sortedPatterns = allPatterns
                .sort((a, b) => b.weight - a.weight)
                .slice(0, 15);
            
            container.innerHTML = sortedPatterns.map(pattern => `
                <div class="pattern-item">
                    <div class="pattern-key">${pattern.key}</div>
                    <div class="pattern-value">${pattern.type} - משקל: ${pattern.weight.toFixed(2)}</div>
                    <span class="pattern-weight">${Math.round(pattern.weight * 100)}%</span>
                    <span class="pattern-frequency">${pattern.frequency}x</span>
                </div>
            `).join('');
        }
        
        function displayCategoryPatterns() {
            const container = document.getElementById('category-patterns');
            const patterns = learningData.profile.patterns || {};
            const categoryPatterns = patterns.keyword_category || {};
            
            if (Object.keys(categoryPatterns).length === 0) {
                container.innerHTML = '<div class="empty-state"><h4>אין דפוסי קטגוריות</h4><p>בחר קטגוריות למיילים כדי לבנות דפוסי למידה</p></div>';
                return;
            }
            
            const sortedPatterns = Object.entries(categoryPatterns)
                .sort((a, b) => b[1].frequency - a[1].frequency)
                .slice(0, 10);
            
            container.innerHTML = sortedPatterns.map(([key, data]) => `
                <div class="pattern-item">
                    <div class="pattern-key">${key}</div>
                    <div class="pattern-value">קטגוריה: ${data.value}</div>
                    <span class="pattern-weight">${Math.round(data.weight * 100)}%</span>
                    <span class="pattern-frequency">${data.frequency}x</span>
                </div>
            `).join('');
        }
        
        function displayDetailedStats() {
            const container = document.getElementById('detailed-stats');
            const stats = learningData.stats;
            
            const progress = calculateLearningLevel(stats);
            const accuracy = calculateAccuracy(stats);
            
            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div>
                        <h4>משוב על חשיבות</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(100, (stats.importance_feedback || 0) * 5)}%"></div>
                        </div>
                        <p>${stats.importance_feedback || 0} משובים</p>
                    </div>
                    <div>
                        <h4>משוב על קטגוריות</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(100, (stats.category_feedback || 0) * 5)}%"></div>
                        </div>
                        <p>${stats.category_feedback || 0} משובים</p>
                    </div>
                    <div>
                        <h4>רמת למידה</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <p>${progress}%</p>
                        <small>מבוסס על: ${stats.total_feedback || 0} משובים, ${stats.total_patterns || 0} דפוסים</small>
                    </div>
                    <div>
                        <h4>דיוק ניבוי</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${accuracy}%"></div>
                        </div>
                        <p>${accuracy}%</p>
                        <small>מבוסס על השוואה בין ציוני המשתמש ל-AI</small>
                    </div>
                    <div>
                        <h4>דפוסים פעילים</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(100, (stats.active_patterns || 0) * 5)}%"></div>
                        </div>
                        <p>${stats.active_patterns || 0} דפוסים</p>
                        <small>דפוסים ששימשו בחודש האחרון</small>
                    </div>
                    <div>
                        <h4>מגוון למידה</h4>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(100, (stats.total_patterns || 0) * 2)}%"></div>
                        </div>
                        <p>${stats.total_patterns || 0} דפוסים</p>
                        <small>סה"כ דפוסי למידה שנוצרו</small>
                    </div>
                </div>
            `;
        }
        
        async function refreshData() {
            showStatus('מרענן נתונים...', 'info');
            await loadLearningData();
        }
        
        async function exportProfile() {
            try {
                showStatus('מייצא פרופיל...', 'info');
                
                const response = await fetch('/api/user-profile');
                const profile = await response.json();
                
                const dataStr = JSON.stringify(profile, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `user_profile_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                showStatus('פרופיל יוצא בהצלחה!', 'success');
            } catch (error) {
                showStatus('שגיאה בייצוא פרופיל: ' + error.message, 'error');
            }
        }
        
        async function resetLearning() {
            if (!confirm('האם אתה בטוח שברצונך לאפס את מערכת הלמידה? פעולה זו לא ניתנת לביטול.')) {
                return;
            }
            
            try {
                showStatus('מאפס מערכת למידה...', 'info');
                
                // כאן נוסיף API לאפס את הלמידה
                // await fetch('/api/reset-learning', { method: 'POST' });
                
                showStatus('מערכת הלמידה אופסה בהצלחה!', 'success');
                await loadLearningData();
            } catch (error) {
                showStatus('שגיאה באיפוס מערכת הלמידה: ' + error.message, 'error');
            }
        }
        
        async function clearAllData() {
            if (!confirm('האם אתה בטוח שברצונך למחוק את כל הנתונים? פעולה זו לא ניתנת לביטול.')) {
                return;
            }
            
            try {
                showStatus('מוחק נתונים...', 'info');
                
                // כאן נוסיף API למחיקת כל הנתונים
                // await fetch('/api/clear-all-data', { method: 'POST' });
                
                showStatus('כל הנתונים נמחקו!', 'success');
                await loadLearningData();
            } catch (error) {
                showStatus('שגיאה במחיקת נתונים: ' + error.message, 'error');
            }
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        }
        
        async function loadUserPreferences() {
            try {
                const response = await fetch('/api/user-preferences');
                const prefs = await response.json();
                
                // טעינת קטגוריות חשובות
                if (prefs.important_categories) {
                    userPreferences.importantCategories = prefs.important_categories;
                    prefs.important_categories.forEach(category => {
                        const checkbox = document.getElementById(`pref-${category}`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
                
                // טעינת שולחים חשובים
                if (prefs.important_senders) {
                    userPreferences.importantSenders = prefs.important_senders;
                    displayImportantSenders();
                }
                
                // טעינת מילות מפתח חשובות
                if (prefs.important_keywords) {
                    userPreferences.importantKeywords = prefs.important_keywords;
                    displayImportantKeywords();
                }
                
            } catch (error) {
                console.error('שגיאה בטעינת העדפות משתמש:', error);
            }
        }
        
        function addImportantSender() {
            const input = document.getElementById('sender-input');
            const sender = input.value.trim();
            
            if (sender && !userPreferences.importantSenders.includes(sender)) {
                userPreferences.importantSenders.push(sender);
                input.value = '';
                displayImportantSenders();
            }
        }
        
        function addImportantKeyword() {
            const input = document.getElementById('keyword-input');
            const keyword = input.value.trim();
            
            if (keyword && !userPreferences.importantKeywords.includes(keyword)) {
                userPreferences.importantKeywords.push(keyword);
                input.value = '';
                displayImportantKeywords();
            }
        }
        
        function removeImportantSender(sender) {
            userPreferences.importantSenders = userPreferences.importantSenders.filter(s => s !== sender);
            displayImportantSenders();
        }
        
        function removeImportantKeyword(keyword) {
            userPreferences.importantKeywords = userPreferences.importantKeywords.filter(k => k !== keyword);
            displayImportantKeywords();
        }
        
        function displayImportantSenders() {
            const container = document.getElementById('important-senders-list');
            container.innerHTML = userPreferences.importantSenders.map(sender => `
                <div class="sender-item">
                    <button class="remove-btn" onclick="removeImportantSender('${sender}')">×</button>
                    ${sender}
                </div>
            `).join('');
        }
        
        function displayImportantKeywords() {
            const container = document.getElementById('important-keywords-list');
            container.innerHTML = userPreferences.importantKeywords.map(keyword => `
                <div class="keyword-item">
                    <button class="remove-btn" onclick="removeImportantKeyword('${keyword}')">×</button>
                    ${keyword}
                </div>
            `).join('');
        }
        
        async function saveUserPreferences() {
            try {
                // איסוף קטגוריות חשובות
                const importantCategories = [];
                document.querySelectorAll('.category-checkboxes input:checked').forEach(checkbox => {
                    importantCategories.push(checkbox.value);
                });
                
                const preferences = {
                    important_categories: importantCategories,
                    important_senders: userPreferences.importantSenders,
                    important_keywords: userPreferences.importantKeywords
                };
                
                const response = await fetch('/api/user-preferences', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(preferences)
                });
                
                const result = await response.json();
                if (result.success) {
                    showStatus('הגדרות נשמרו בהצלחה!', 'success');
                } else {
                    showStatus('שגיאה בשמירת הגדרות: ' + result.message, 'error');
                }
                
            } catch (error) {
                showStatus('שגיאה בשמירת הגדרות: ' + error.message, 'error');
            }
        }

        // פונקציות למודל פרטים מפורטים
        function showDetailedStats(type) {
            const modal = document.getElementById('detailed-stats-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            
            modal.style.display = 'flex';
            
            switch(type) {
                case 'feedback':
                    showFeedbackDetails(modalTitle, modalBody);
                    break;
                case 'patterns':
                    showPatternsDetails(modalTitle, modalBody);
                    break;
                case 'learning':
                    showLearningDetails(modalTitle, modalBody);
                    break;
                case 'accuracy':
                    showAccuracyDetails(modalTitle, modalBody);
                    break;
            }
        }

        function closeDetailedStats() {
            const modal = document.getElementById('detailed-stats-modal');
            modal.style.display = 'none';
        }

        function showFeedbackDetails(title, body) {
            title.textContent = '📊 פרטים מפורטים - סה״כ משובים';
            
            const stats = learningData.stats || {};
            const totalFeedback = stats.total_feedback || 0;
            const importanceFeedback = stats.importance_feedback || 0;
            const categoryFeedback = stats.category_feedback || 0;
            
            body.innerHTML = `
                <div class="chart-container">
                    <div class="chart-title">📈 התפלגות משובים</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <h4>משוב על חשיבות</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(100, (importanceFeedback / Math.max(totalFeedback, 1)) * 100)}%"></div>
                            </div>
                            <p>${importanceFeedback} משובים</p>
                            <small>${Math.round((importanceFeedback / Math.max(totalFeedback, 1)) * 100)}% מכלל המשובים</small>
                        </div>
                        <div>
                            <h4>משוב על קטגוריות</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(100, (categoryFeedback / Math.max(totalFeedback, 1)) * 100)}%"></div>
                            </div>
                            <p>${categoryFeedback} משובים</p>
                            <small>${Math.round((categoryFeedback / Math.max(totalFeedback, 1)) * 100)}% מכלל המשובים</small>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">📊 סטטיסטיקות נוספות</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div style="text-align: center; padding: 15px; background: #e3f2fd; border-radius: 10px;">
                            <div style="font-size: 2em; font-weight: bold; color: #1976d2;">${totalFeedback}</div>
                            <div style="color: #666;">סה״כ משובים</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #f3e5f5; border-radius: 10px;">
                            <div style="font-size: 2em; font-weight: bold; color: #7b1fa2;">${Math.round(totalFeedback / 7)}</div>
                            <div style="color: #666;">משובים בשבוע</div>
                        </div>
                        <div style="text-align: center; padding: 15px; background: #e8f5e8; border-radius: 10px;">
                            <div style="font-size: 2em; font-weight: bold; color: #2e7d32;">${Math.round(totalFeedback / 30)}</div>
                            <div style="color: #666;">משובים ביום</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border-left: 4px solid #ffc107;">
                    <h4>💡 טיפ לשיפור</h4>
                    <p>ככל שתעניק יותר משוב על מיילים ופגישות, המערכת תלמד טוב יותר את העדפותיך ותהיה מדויקת יותר בחישוב החשיבות.</p>
                </div>
            `;
        }

        function showPatternsDetails(title, body) {
            title.textContent = '🧠 פרטים מפורטים - דפוסי למידה';
            
            const patterns = learningData.profile.patterns || {};
            const totalPatterns = Object.keys(patterns).length;
            
            // ספירת דפוסים לפי סוג
            const keywordPatterns = Object.keys(patterns.keyword_importance || {}).length;
            const senderPatterns = Object.keys(patterns.sender_importance || {}).length;
            const domainPatterns = Object.keys(patterns.domain_importance || {}).length;
            const timePatterns = Object.keys(patterns.time_importance || {}).length;
            
            body.innerHTML = `
                <div class="chart-container">
                    <div class="chart-title">📊 התפלגות דפוסי למידה</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <h4>מילות מפתח</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(100, (keywordPatterns / Math.max(totalPatterns, 1)) * 100)}%"></div>
                            </div>
                            <p>${keywordPatterns} דפוסים</p>
                            <small>מילות מפתח חשובות</small>
                        </div>
                        <div>
                            <h4>שולחים</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(100, (senderPatterns / Math.max(totalPatterns, 1)) * 100)}%"></div>
                            </div>
                            <p>${senderPatterns} דפוסים</p>
                            <small>שולחים חשובים</small>
                        </div>
                        <div>
                            <h4>דומיינים</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(100, (domainPatterns / Math.max(totalPatterns, 1)) * 100)}%"></div>
                            </div>
                            <p>${domainPatterns} דפוסים</p>
                            <small>דומיינים חשובים</small>
                        </div>
                        <div>
                            <h4>זמנים</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(100, (timePatterns / Math.max(totalPatterns, 1)) * 100)}%"></div>
                            </div>
                            <p>${timePatterns} דפוסים</p>
                            <small>זמנים חשובים</small>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">🔝 הדפוסים הפעילים ביותר</div>
                    <div style="max-height: 300px; overflow-y: auto;">
                        ${getTopPatterns(patterns)}
                    </div>
                </div>
                
                <div style="background: #d1ecf1; padding: 15px; border-radius: 10px; border-left: 4px solid #17a2b8;">
                    <h4>🎯 איך זה עובד?</h4>
                    <p>המערכת לומדת מההתנהגות שלך ומזהה דפוסים. למשל, אם אתה תמיד נותן ציון גבוה למיילים מ"מנהל", המערכת תלמד שמיילים מהמנהל חשובים לך.</p>
                </div>
            `;
        }

        function showLearningDetails(title, body) {
            title.textContent = '📈 פרטים מפורטים - רמת למידה';
            
            const stats = learningData.stats || {};
            const learningLevel = calculateLearningLevel(stats);
            const totalFeedback = stats.total_feedback || 0;
            const totalPatterns = stats.total_patterns || 0;
            
            body.innerHTML = `
                <div class="chart-container">
                    <div class="chart-title">📊 רמת למידה נוכחית</div>
                    <div style="text-align: center; margin: 30px 0;">
                        <div style="font-size: 4em; font-weight: bold; color: #4CAF50; margin-bottom: 10px;">${learningLevel}%</div>
                        <div style="font-size: 1.2em; color: #666;">רמת למידה</div>
                        <div class="progress-bar" style="margin: 20px auto; max-width: 400px;">
                            <div class="progress-fill" style="width: ${learningLevel}%"></div>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">📈 התקדמות למידה</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <h4>משובים</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(100, (totalFeedback / 100) * 100)}%"></div>
                            </div>
                            <p>${totalFeedback} משובים</p>
                            <small>${totalFeedback >= 100 ? 'מעולה!' : `עוד ${100 - totalFeedback} משובים למטרה`}</small>
                        </div>
                        <div>
                            <h4>דפוסים</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(100, (totalPatterns / 50) * 100)}%"></div>
                            </div>
                            <p>${totalPatterns} דפוסים</p>
                            <small>${totalPatterns >= 50 ? 'מעולה!' : `עוד ${50 - totalPatterns} דפוסים למטרה`}</small>
                        </div>
                    </div>
                </div>
                
                <div style="background: #d4edda; padding: 15px; border-radius: 10px; border-left: 4px solid #28a745;">
                    <h4>🚀 איך לשפר את רמת הלמידה?</h4>
                    <ul style="margin: 10px 0; padding-right: 20px;">
                        <li>תן משוב על מיילים ופגישות חשובים</li>
                        <li>סמן קטגוריות למיילים שונים</li>
                        <li>השתמש במערכת באופן קבוע</li>
                        <li>תן משוב על דיוק הציונים</li>
                    </ul>
                </div>
            `;
        }

        function showAccuracyDetails(title, body) {
            title.textContent = '🎯 פרטים מפורטים - דיוק ניבוי';
            
            const stats = learningData.stats || {};
            const accuracy = calculateAccuracy(stats);
            
            body.innerHTML = `
                <div class="chart-container">
                    <div class="chart-title">🎯 דיוק ניבוי נוכחי</div>
                    <div style="text-align: center; margin: 30px 0;">
                        <div style="font-size: 4em; font-weight: bold; color: ${accuracy >= 80 ? '#4CAF50' : accuracy >= 60 ? '#ff9800' : '#f44336'}; margin-bottom: 10px;">${accuracy}%</div>
                        <div style="font-size: 1.2em; color: #666;">דיוק ניבוי</div>
                        <div class="progress-bar" style="margin: 20px auto; max-width: 400px;">
                            <div class="progress-fill" style="width: ${accuracy}%; background: ${accuracy >= 80 ? 'linear-gradient(90deg, #4CAF50, #45a049)' : accuracy >= 60 ? 'linear-gradient(90deg, #ff9800, #f57c00)' : 'linear-gradient(90deg, #f44336, #d32f2f)'};"></div>
                        </div>
                        <div style="margin-top: 15px; font-size: 1.1em; color: ${accuracy >= 80 ? '#4CAF50' : accuracy >= 60 ? '#ff9800' : '#f44336'};">
                            ${accuracy >= 80 ? 'מעולה! המערכת מנבאת נכון' : accuracy >= 60 ? 'טוב, יש מקום לשיפור' : 'נדרש שיפור משמעותי'}
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">📊 השוואת דיוק</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div>
                            <h4>דיוק נוכחי</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${accuracy}%"></div>
                            </div>
                            <p>${accuracy}%</p>
                        </div>
                        <div>
                            <h4>מטרה</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 80%"></div>
                            </div>
                            <p>80%</p>
                        </div>
                        <div>
                            <h4>מעולה</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 90%"></div>
                            </div>
                            <p>90%</p>
                        </div>
                    </div>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; border-left: 4px solid #ffc107;">
                    <h4>💡 איך לשפר דיוק?</h4>
                    <ul style="margin: 10px 0; padding-right: 20px;">
                        <li>תן משוב מדויק על חשיבות מיילים</li>
                        <li>סמן קטגוריות נכון</li>
                        <li>תן משוב על טעויות של המערכת</li>
                        <li>השתמש במערכת באופן קבוע</li>
                    </ul>
                </div>
            `;
        }

        function getTopPatterns(patterns) {
            const allPatterns = [];
            
            // איסוף כל הדפוסים
            Object.entries(patterns.keyword_importance || {}).forEach(([key, data]) => {
                allPatterns.push({key, type: 'מילת מפתח', weight: data.weight, frequency: data.frequency});
            });
            
            Object.entries(patterns.sender_importance || {}).forEach(([key, data]) => {
                allPatterns.push({key, type: 'שולח', weight: data.weight, frequency: data.frequency});
            });
            
            Object.entries(patterns.domain_importance || {}).forEach(([key, data]) => {
                allPatterns.push({key, type: 'דומיין', weight: data.weight, frequency: data.frequency});
            });
            
            Object.entries(patterns.time_importance || {}).forEach(([key, data]) => {
                allPatterns.push({key, type: 'זמן', weight: data.weight, frequency: data.frequency});
            });
            
            // מיון לפי משקל
            const sortedPatterns = allPatterns
                .sort((a, b) => b.weight - a.weight)
                .slice(0, 10);
            
            if (sortedPatterns.length === 0) {
                return '<p style="text-align: center; color: #666; padding: 20px;">אין דפוסים פעילים</p>';
            }
            
            return sortedPatterns.map(pattern => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; margin: 5px 0; border-radius: 8px;">
                    <div>
                        <strong>${pattern.key}</strong>
                        <small style="color: #666; margin-right: 10px;">(${pattern.type})</small>
                    </div>
                    <div style="text-align: left;">
                        <div style="font-weight: bold; color: #4CAF50;">${Math.round(pattern.weight * 100)}%</div>
                        <small style="color: #666;">${pattern.frequency}x</small>
                    </div>
                </div>
            `).join('');
        }

        // סגירת המודל בלחיצה מחוץ לו
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('detailed-stats-modal');
            if (event.target === modal) {
                closeDetailedStats();
            }
        });
    </script>
</body>
</html>
